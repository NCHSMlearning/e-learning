<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NCHSM Student Portal</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /*
        * CRITICAL FIX: Only show the active tab content
        */
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }

        /* Set Inter font and warmer background */
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
        }

        /* Sidebar link styling */
        .nav-link {
            transition: all 0.2s ease-in-out;
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            border-radius: 0.75rem; /* Smoother corners */
        }
        .nav-link:hover {
            background-color: #1e293b; /* Slate 800 on hover */
        }
        .nav-link.active {
            background-color: #10b981; /* Emerald 500 for active link */
            color: #ffffff;
            font-weight: 600;
        }
        
        /* Loading Spinner Animation */
        .loader {
            border: 4px solid #e2e8f0;
            border-top: 4px solid #10b981;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 flex h-screen overflow-hidden">

    <script type="module">
        // ************************************************************************* // ** MANDATORY CONFIGURATION: UPDATE THESE VALUES ** // ************************************************************************* // ** SUPABASE CONFIGURATION ** const SUPABASE_URL = 'https://lwhtjozfsmbyihenfunw.supabase.co'; 
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx3aHRqb3pmc21ieWloZW5mdW53Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2NTgxMjcsImV4cCI6MjA3NTIzNDEyN30.7Z8AYvPQwTAEEEhODlW6Xk-IR1FK3Uj5ivZS7P17Wpk'; 
        const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY); 

        // ** LOCATIONIQ CONFIGURATION (Geocoding API) ** const LOCATIONIQ_API_KEY = 'pk.cbe61eae35ecbe1d1d682c347d81381c'; 
        const LOCATIONIQ_API_URL = 'https://us1.locationiq.com/v1/reverse.php';
        
        // --- Application State ---
        // Simulate a logged-in user with a persistent anonymous ID for Supabase RLS simplicity
        let currentUserId = localStorage.getItem('user_id') || crypto.randomUUID(); 
        localStorage.setItem('user_id', currentUserId);
        
        let isAuthReady = true; // Assume ready since we rely on ANON key and generated ID

        const loader = document.getElementById('loader');
        const mainContent = document.getElementById('main-content-area');
        const sidebar = document.getElementById('sidebar');
        const navLinks = document.querySelectorAll('.nav-link');
        const userStatusText = document.getElementById('user-status-text');

        // Supabase Table Constants
        const WELCOME_MESSAGE_TABLE = 'portal_settings';
        const ATTENDANCE_TABLE = 'attendance_records';

        /**
         * Converts an ISO 8601 string or Date object to a formatted date string.
         * @param {string|Date} date - ISO 8601 string from Supabase or Date object.
         * @returns {string} Formatted date string.
         */
        const formatDate = (date) => {
            if (!date) return 'N/A';
            const dateObj = date instanceof Date ? date : new Date(date);
            return dateObj.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        };
        
        /**
         * Calls LocationIQ to reverse geocode coordinates (simulated).
         * @param {number} lat - Latitude.
         * @param {number} lon - Longitude.
         * @returns {Promise<string>} Formatted location name.
         */
        const getLocationFromCoordinates = async (lat, lon) => {
            try {
                // LocationIQ API call using the provided key and URL
                const response = await fetch(`${LOCATIONIQ_API_URL}?key=${LOCATIONIQ_API_KEY}&lat=${lat}&lon=${lon}&format=json`);
                const data = await response.json();
                // Return a concise address string
                return data.display_name || 'Unknown Location';
            } catch (error) {
                console.error("LocationIQ API Error:", error);
                return 'Location Unavailable';
            }
        };

        /**
         * Sets up the real-time listener for the dynamic welcome message using Supabase.
         */
        const setupWelcomeMessageListener = () => {
            const welcomeMessageText = document.getElementById('welcome-message-text');
            const welcomeMessageCard = document.getElementById('welcome-message-card');

            if (!welcomeMessageText) return;

            // 1. Initial Fetch (assuming the message is stored in a record with ID 1 in portal_settings)
            sb.from(WELCOME_MESSAGE_TABLE)
                .select('message')
                .eq('id', 1) 
                .single()
                .then(({ data, error }) => {
                    if (error && error.code !== 'PGRST116') { // PGRST116 is "found 0 rows"
                        console.error("Supabase initial fetch error:", error.message);
                        welcomeMessageText.textContent = 'Failed to load updates. Check console for details.';
                    } else if (data && data.message) {
                        welcomeMessageText.textContent = data.message;
                    } else {
                        welcomeMessageText.textContent = 'Access your learning tools and updates.';
                    }
                    welcomeMessageCard.classList.remove('hidden');
                });

            // 2. Real-time Subscription (for superadmin updates)
            sb.channel('welcome-updates')
                .on('postgres_changes', { 
                    event: 'UPDATE', 
                    schema: 'public', 
                    table: WELCOME_MESSAGE_TABLE, 
                    filter: 'id=eq.1' 
                }, (payload) => {
                    console.log('Welcome Message Realtime Update:', payload);
                    if (payload.new && payload.new.message) {
                         welcomeMessageText.textContent = payload.new.message;
                    }
                })
                .subscribe();
        };

        /**
         * Initializes Supabase and user status.
         */
        const initApp = async () => {
            try {
                // Authentication placeholder: we use a consistent UUID and ANON key for data access
                userStatusText.textContent = `User ID: ${currentUserId.substring(0, 8)}...`;
                
                // Show content and hide loader
                loader.classList.add('hidden');
                mainContent.classList.remove('hidden');

                // Start Supabase listeners
                setupWelcomeMessageListener();
                setupAttendanceListener();

            } catch (error) {
                console.error("Application initialization error:", error);
                userStatusText.textContent = `Error: ${error.message}`;
                loader.classList.add('hidden');
            }
        };

        /**
         * Toggles the mobile sidebar visibility.
         */
        const toggleSidebar = () => {
            sidebar.classList.toggle('-translate-x-full');
        };

        /**
         * Shows the selected content tab and updates the active navigation link.
         * @param {string} tabId - The ID of the tab content to display.
         */
        const showTab = (tabId) => {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');

            navLinks.forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`.nav-link[data-tab="${tabId}"]`).classList.add('active');
        };

        /**
         * Updates the session detail dropdown options based on the selected session type.
         * @param {string} sessionType - The value of the selected session type ('in-class' or 'clinical-rotation').
         */
        const updateAttendanceDetail = (sessionType) => {
            const sessionDetailSelect = document.getElementById('session-detail');
            sessionDetailSelect.innerHTML = '<option value="" disabled selected>Select Detail</option>';
            sessionDetailSelect.disabled = true; // Disable until options are populated

            // Clinical Rotation List matching user's exact request
            const clinicalRotations = [
                'Maternity Medical surgical rotation',
                'OPD casuality rotation',
                'MCH peaditrics rotaion',
                'Psyschiatry',
                'Theatre rotation',
                'ICU rotation',
            ];

            if (sessionType === 'in-class') {
                // Placeholder for courses ("my courses")
                const courses = ['Fundamentals of Nursing', 'Anatomy & Physiology', 'Pharmacology', 'Public Health'];
                courses.forEach(course => {
                    const option = document.createElement('option');
                    option.value = course.toLowerCase().replace(/[^a-z0-9]+/g, '-');
                    option.textContent = course + " (My Course)";
                    sessionDetailSelect.appendChild(option);
                });
                sessionDetailSelect.disabled = false;
            } else if (sessionType === 'clinical-rotation') {
                // Display specific clinical rotations
                clinicalRotations.forEach(rotation => {
                    const option = document.createElement('option');
                    option.value = rotation.toLowerCase().replace(/[^a-z0-9]+/g, '-');
                    option.textContent = rotation;
                    sessionDetailSelect.appendChild(option);
                });
                sessionDetailSelect.disabled = false;
            }

            // Re-validate the form state
            validateAttendanceForm();
        };


        /**
         * Validates the attendance form fields and enables/disables the check-in button.
         */
        const validateAttendanceForm = () => {
            const sessionType = document.getElementById('session-type').value;
            const sessionDetail = document.getElementById('session-detail').value;
            const checkInButton = document.getElementById('check-in-button');

            const isValid = sessionType && sessionDetail;
            checkInButton.disabled = !isValid;
            checkInButton.classList.toggle('opacity-50', !isValid);
            checkInButton.classList.toggle('hover:bg-emerald-600', isValid);
        };

        /**
         * Handles the check-in process using Supabase.
         */
        const handleCheckIn = async () => {
            if (!isAuthReady || !currentUserId) return;

            const sessionType = document.getElementById('session-type').value;
            const sessionDetail = document.getElementById('session-detail').value;
            const checkInButton = document.getElementById('check-in-button');
            const attendanceMessage = document.getElementById('attendance-message');

            checkInButton.disabled = true;
            attendanceMessage.textContent = 'Checking in... (1/2: Geo-locating)';
            attendanceMessage.classList.remove('text-red-500', 'text-green-500');
            attendanceMessage.classList.add('text-blue-500');

            // --- Geolocation and Reverse Geocoding (Simulated) ---
            let locationName = 'Location Unavailable';
            try {
                // Simulating coordinates for the LocationIQ API call (Nairobi)
                const lat = -1.2884; 
                const lon = 36.8233; 
                locationName = await getLocationFromCoordinates(lat, lon);
                attendanceMessage.textContent = `Checking in... (2/2: Logging Attendance from ${locationName})`;
            } catch (e) {
                console.warn("Geolocation/LocationIQ step failed/ignored. Proceeding without location:", e);
            }

            try {
                // 1. Check if user has already checked in today for the same detail
                const { data: todayRecords, error: fetchError } = await sb
                    .from(ATTENDANCE_TABLE)
                    .select('session_detail, check_in_time')
                    .eq('user_id', currentUserId);
                
                if (fetchError) throw fetchError;

                const today = new Date().toISOString().split('T')[0];
                const alreadyCheckedIn = todayRecords.some(record => {
                    const recordDate = new Date(record.check_in_time).toISOString().split('T')[0];
                    return recordDate === today && record.session_detail === sessionDetail;
                });

                if (alreadyCheckedIn) {
                    attendanceMessage.textContent = `You have already checked into "${sessionDetail}" today.`;
                    attendanceMessage.classList.remove('text-blue-500');
                    attendanceMessage.classList.add('text-red-500');
                    return;
                }

                // 2. Perform Check-In (Supabase Insert)
                const { error: insertError } = await sb
                    .from(ATTENDANCE_TABLE)
                    .insert([
                        {
                            user_id: currentUserId,
                            session_type: sessionType,
                            session_detail: sessionDetail,
                            check_in_time: new Date().toISOString(),
                            location_name: locationName 
                        }
                    ]);

                if (insertError) throw insertError;


                attendanceMessage.textContent = 'Check-in successful! Your attendance has been recorded.';
                attendanceMessage.classList.remove('text-blue-500');
                attendanceMessage.classList.add('text-green-500');
                
            } catch (error) {
                console.error("Check-in failed:", error);
                attendanceMessage.textContent = `Check-in failed: ${error.message}. Please try again.`;
                attendanceMessage.classList.remove('text-blue-500');
                attendanceMessage.classList.add('text-red-500');
            } finally {
                checkInButton.disabled = false;
                checkInButton.classList.remove('opacity-50');
            }
        };

        /**
         * Sets up the real-time listener for the student's attendance history using Supabase.
         */
        const setupAttendanceListener = () => {
            const attendanceHistoryBody = document.getElementById('attendance-history-body');
            
            const fetchAndRenderAttendance = async () => {
                attendanceHistoryBody.innerHTML = '<tr><td colspan="3" class="p-3 text-center text-gray-500">Loading history...</td></tr>';

                const { data: records, error } = await sb
                    .from(ATTENDANCE_TABLE)
                    .select('session_type, session_detail, check_in_time')
                    .eq('user_id', currentUserId) // Filter only the current user's records
                    .order('check_in_time', { ascending: false });

                if (error) {
                    console.error("Error fetching attendance history:", error);
                    attendanceHistoryBody.innerHTML = `<tr><td colspan="3" class="p-3 text-center text-red-500">Error loading history: ${error.message}</td></tr>`;
                    return;
                }

                attendanceHistoryBody.innerHTML = ''; // Clear previous entries
                
                if (!records || records.length === 0) {
                    attendanceHistoryBody.innerHTML = '<tr><td colspan="3" class="p-3 text-center text-gray-500">No attendance records found.</td></tr>';
                    return;
                }

                records.forEach(record => {
                    const row = document.createElement('tr');
                    row.className = 'border-b hover:bg-emerald-50/50 transition-colors duration-150';
                    row.innerHTML = `
                        <td class="p-3 text-sm text-gray-700 font-medium">${formatDate(record.check_in_time)}</td>
                        <td class="p-3 text-sm text-gray-700 capitalize">${record.session_type.replace('-', ' ')}</td>
                        <td class="p-3 text-sm text-gray-700">${record.session_detail}</td>
                    `;
                    attendanceHistoryBody.appendChild(row);
                });
            };

            // 1. Initial Fetch
            fetchAndRenderAttendance();

            // 2. Real-time Subscription for user-specific changes
            sb.channel('attendance-updates')
                .on('postgres_changes', { 
                    event: '*', 
                    schema: 'public', 
                    table: ATTENDANCE_TABLE,
                }, (payload) => {
                    // Re-fetch and render when any change occurs (optimizing for simplicity)
                    console.log('Attendance Realtime Change Detected, refreshing history:', payload);
                    fetchAndRenderAttendance();
                })
                .subscribe();
        };

        /**
         * Displays a simple toast/message for logout (simulated, as there is no real Supabase sign out here).
         */
        const showLogoutToast = () => {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-5 right-5 bg-yellow-500 text-white p-4 rounded-lg shadow-xl z-50 transition-opacity duration-300';
            toast.textContent = 'Simulating logout...';
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.remove();
            }, 3000);
        };

        // --- Event Listeners and Initial Setup ---
        window.addEventListener('load', () => {
            initApp();
            
            const checkInButton = document.getElementById('check-in-button');
            const menuToggle = document.getElementById('menu-toggle');
            const logoutLink = document.getElementById('logout-link');
            const sessionTypeSelect = document.getElementById('session-type');
            const sessionDetailSelect = document.getElementById('session-detail');

            // Initial check to disable button
            validateAttendanceForm();

            checkInButton.addEventListener('click', handleCheckIn);
            menuToggle.addEventListener('click', toggleSidebar);

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    if (link.id === 'logout-link') return;
                    e.preventDefault();
                    const tabId = link.getAttribute('data-tab');
                    if (tabId) {
                        showTab(tabId);
                    }
                    // Close sidebar on small screen after selection
                    if (window.innerWidth < 1024 && !sidebar.classList.contains('-translate-x-full')) {
                        toggleSidebar();
                    }
                });
            });

            // Logout (Simulated for this configuration)
            logoutLink.addEventListener('click', async (e) => {
                e.preventDefault();
                showLogoutToast();
                // In a real Supabase application, you would call sb.auth.signOut();
            });

            // Update session detail and validate form on type change
            sessionTypeSelect.addEventListener('change', (e) => {
                updateAttendanceDetail(e.target.value);
            });

            // Validate form on detail change
            sessionDetailSelect.addEventListener('change', validateAttendanceForm);

            // Initially show the dashboard
            showTab('dashboard-tab');
        });
    </script>


    <!-- Sidebar (Navigation) -->
    <aside id="sidebar" class="w-64 bg-slate-900 text-white fixed inset-y-0 left-0 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out z-40 p-4 shadow-2xl">
        <div class="h-full flex flex-col">
            <!-- Logo and Title -->
            <div class="flex items-center justify-center p-4 border-b border-slate-700 mb-6">
                <svg class="w-8 h-8 text-emerald-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.47 9.246 5 7.5 5S4.168 5.47 3 6.253v13C4.168 18.47 5.754 18 7.5 18s3.332.47 4.5 1.253m0-13C13.168 5.47 14.754 5 16.5 5s3.332.47 4.5 1.253v13C19.832 18.47 18.246 18 16.5 18s-3.332.47-4.5 1.253"></path></svg>
                <h1 class="text-xl font-extrabold text-white">NCHSM Portal</h1>
            </div>

            <!-- Navigation Links -->
            <nav class="space-y-2 flex-grow">
                <a href="#" class="nav-link active" data-tab="dashboard-tab">
                    <!-- Icon: Home -->
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 000-1 1h3m-9 11h9.333a2 2 0 002-2V7.414a2 2 0 00-.586-1.414l-4.243-4.243a2 2 0 00-1.414-.586H6a2 2 0 00-2 2v9.586a2 2 0 00.586 1.414l4.243 4.243a2 2 0 001.414.586H12z"></path></svg>
                    <span>Dashboard</span>
                </a>
                
                <!-- NEW: My Courses -->
                <a href="#" class="nav-link" data-tab="my-courses-tab">
                    <!-- Icon: Book/Courses -->
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.47 9.246 5 7.5 5S4.168 5.47 3 6.253v13C4.168 18.47 5.754 18 7.5 18s3.332.47 4.5 1.253m0-13C13.168 5.47 14.754 5 16.5 5s3.332.47 4.5 1.253v13C19.832 18.47 18.246 18 16.5 18s-3.332.47-4.5 1.253"></path></svg>
                    <span>My Courses</span>
                </a>

                <a href="#" class="nav-link" data-tab="attendance-tab">
                    <!-- Icon: Clock -->
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <span>Attendance</span>
                </a>

                <!-- NEW: CATS/Exams -->
                <a href="#" class="nav-link" data-tab="cats-exams-tab">
                    <!-- Icon: Award/Exam -->
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.20A9 9 0 1120.5 10H10a2 2 0 00-2 2v2a2 2 0 002 2h10.5a9 9 0 11-4.882-9.20z"></path></svg>
                    <span>CATS/Exams</span>
                </a>

                <!-- NEW: Resources -->
                <a href="#" class="nav-link" data-tab="resources-tab">
                    <!-- Icon: Folder -->
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg>
                    <span>Resources</span>
                </a>
                
                <!-- NEW: Messages -->
                <a href="#" class="nav-link" data-tab="messages-tab">
                    <!-- Icon: Mail -->
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8m-2 4v7a2 2 0 01-2 2H5a2 2 0 01-2-2v-7"></path></svg>
                    <span>Messages</span>
                </a>

                <a href="#" class="nav-link" data-tab="profile-tab">
                    <!-- Icon: User -->
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                    <span>Profile</span>
                </a>
            </nav>

            <!-- Logout -->
            <div class="mt-auto pt-4 border-t border-slate-700">
                <a href="#" id="logout-link" class="nav-link text-red-400 hover:bg-red-900">
                    <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                    <span>Logout</span>
                </a>
            </div>
        </div>
    </aside>

    <!-- Main Content Area -->
    <div id="main-content-area" class="flex-1 flex flex-col overflow-y-auto lg:ml-64 transition-all duration-300">
        <!-- Header/Top Bar -->
        <header class="bg-white shadow-md p-4 flex justify-between items-center sticky top-0 z-30">
            <button id="menu-toggle" class="lg:hidden p-2 rounded-lg text-gray-600 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
            <h1 class="text-xl font-semibold text-gray-800 hidden lg:block">Student Dashboard</h1>
            <span id="user-status-text" class="text-sm text-gray-500 truncate max-w-xs">Connecting...</span>
        </header>

        <!-- Loading Screen -->
        <div id="loader" class="absolute inset-0 bg-gray-100/75 flex items-center justify-center z-50">
            <div class="loader"></div>
            <p class="ml-4 text-gray-700 font-medium">Loading Application...</p>
        </div>

        <!-- Content Area -->
        <main class="p-6">
            
            <!-- Welcome Message Section (Dynamic from Supabase) -->
            <div id="welcome-message-card" class="bg-white p-6 rounded-xl shadow-lg mb-6 transition-all duration-300 hidden">
                <h2 class="text-2xl font-bold text-gray-800">Welcome, Student!</h2>
                <p id="welcome-message-text" class="text-gray-600 mt-1">Access your learning tools and updates</p>
            </div>
            <!-- End Welcome Message -->


            <!-- Dashboard Tab Content -->
            <section id="dashboard-tab" class="tab-content active space-y-6">
                <h2 class="text-3xl font-extrabold text-gray-900 mb-4">Overview</h2>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Card 1: Total Hours -->
                    <div class="bg-white p-6 rounded-xl shadow-md border-l-4 border-emerald-500">
                        <p class="text-sm font-medium text-gray-500">Total Hours Logged</p>
                        <p class="text-3xl font-bold text-gray-900 mt-1">125.5</p>
                        <p class="text-xs text-emerald-600 mt-2">Target: 300 Hours</p>
                    </div>

                    <!-- Card 2: Missing Submissions -->
                    <div class="bg-white p-6 rounded-xl shadow-md border-l-4 border-red-500">
                        <p class="text-sm font-medium text-gray-500">Pending Assignments</p>
                        <p class="text-3xl font-bold text-gray-900 mt-1">3</p>
                        <p class="text-xs text-red-600 mt-2">Due this week</p>
                    </div>

                    <!-- Card 3: Notifications -->
                    <div class="bg-white p-6 rounded-xl shadow-md border-l-4 border-yellow-500">
                        <p class="text-sm font-medium text-gray-500">Unread Notifications</p>
                        <p class="text-3xl font-bold text-gray-900 mt-1">7</p>
                        <p class="text-xs text-yellow-600 mt-2">New announcements</p>
                    </div>
                </div>

                <!-- Latest Announcements -->
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Latest Announcements</h3>
                    <ul class="space-y-3">
                        <li class="p-3 bg-gray-50 rounded-lg border-l-4 border-blue-400">
                            <span class="font-medium text-gray-700">Exam Schedule Update:</span> Final exams moved to May 15th.
                        </li>
                        <li class="p-3 bg-gray-50 rounded-lg border-l-4 border-blue-400">
                            <span class="font-medium text-gray-700">Clinical Wear:</span> New standards for surgical rotation attire released.
                        </li>
                    </ul>
                </div>
            </section>
            
            <!-- NEW: My Courses Tab Content -->
            <section id="my-courses-tab" class="tab-content space-y-6">
                <h2 class="text-3xl font-extrabold text-gray-900 mb-4">My Courses & Learning Modules</h2>
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <p class="text-gray-600">This section will show your enrolled courses, progress, and quick links to module content. (Content placeholder)</p>
                    <ul class="mt-4 space-y-2">
                        <li class="p-3 border rounded-lg">Fundamentals of Nursing - 85% Complete</li>
                        <li class="p-3 border rounded-lg">Anatomy & Physiology - View Schedule</li>
                    </ul>
                </div>
            </section>

            <!-- Attendance Tab Content -->
            <section id="attendance-tab" class="tab-content space-y-6">
                <h2 class="text-3xl font-extrabold text-gray-900 mb-4">Daily Attendance Check-In</h2>

                <!-- Check-in Form -->
                <div class="bg-white p-6 rounded-xl shadow-md max-w-lg mx-auto">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Log Your Session</h3>
                    <div class="space-y-4">
                        
                        <!-- Session Type -->
                        <div>
                            <label for="session-type" class="block text-sm font-medium text-gray-700 mb-1">Session Type</label>
                            <select id="session-type" class="p-3 w-full border border-gray-300 rounded-lg focus:ring-emerald-500 focus:border-emerald-500 bg-gray-50">
                                <option value="" disabled selected>Select Session Type</option>
                                <option value="in-class">In-class Session</option>
                                <option value="clinical-rotation">Clinical/Rotation</option>
                            </select>
                        </div>
                        
                        <!-- Session Detail (Dynamically Updated) -->
                        <div>
                            <label for="session-detail" class="block text-sm font-medium text-gray-700 mb-1">Session Detail (Course / Rotation)</label>
                            <select id="session-detail" class="p-3 w-full border border-gray-300 rounded-lg focus:ring-emerald-500 focus:border-emerald-500 bg-gray-50" disabled>
                                <option value="" disabled selected>Select Detail</option>
                            </select>
                        </div>

                        <!-- Check-in Button -->
                        <button id="check-in-button" disabled class="w-full p-3 mt-4 bg-emerald-500 text-white font-bold rounded-lg shadow-lg hover:bg-emerald-600 transition-colors duration-200 opacity-50 cursor-not-allowed">
                            Check In Now
                        </button>
                    </div>

                    <p id="attendance-message" class="mt-4 text-center text-sm font-medium h-5"></p>
                </div>

                <!-- Attendance History -->
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">My Attendance History</h3>
                    <div class="overflow-x-auto rounded-lg border border-gray-200">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
                                    <th class="p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                    <th class="p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Detail</th>
                                </tr>
                            </thead>
                            <tbody id="attendance-history-body" class="bg-white divide-y divide-gray-200">
                                <!-- Records will be inserted here by JavaScript -->
                                <tr><td colspan="3" class="p-3 text-center text-gray-500">Loading history...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- NEW: CATS/Exams Tab Content -->
            <section id="cats-exams-tab" class="tab-content space-y-6">
                <h2 class="text-3xl font-extrabold text-gray-900 mb-4">Continuous Assessments & Exams</h2>
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <p class="text-gray-600">View your assessment scores, exam schedules, and grading reports here. (Content placeholder)</p>
                    <table class="min-w-full mt-4 border">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="p-2 border">Assessment</th>
                                <th class="p-2 border">Score</th>
                                <th class="p-2 border">Due Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="p-2 border">CAT 1 - Pharmacology</td>
                                <td class="p-2 border">88%</td>
                                <td class="p-2 border">Completed</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- NEW: Resources Tab Content -->
            <section id="resources-tab" class="tab-content space-y-6">
                <h2 class="text-3xl font-extrabold text-gray-900 mb-4">Learning Resources & Documents</h2>
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <p class="text-gray-600">Access reading materials, procedure guides, and policy documents. (Content placeholder)</p>
                    <ul class="mt-4 space-y-2">
                        <li class="p-3 border rounded-lg bg-emerald-50 hover:bg-emerald-100 cursor-pointer">Download: Basic Life Support (BLS) Protocol</li>
                        <li class="p-3 border rounded-lg bg-emerald-50 hover:bg-emerald-100 cursor-pointer">View: Student Handbook 2024</li>
                    </ul>
                </div>
            </section>

            <!-- NEW: Messages Tab Content -->
            <section id="messages-tab" class="tab-content space-y-6">
                <h2 class="text-3xl font-extrabold text-gray-900 mb-4">Messages & Communication</h2>
                <div class="bg-white p-6 rounded-xl shadow-md">
                    <p class="text-gray-600">Your communication hub for messages from instructors and the administration. (Content placeholder)</p>
                    <div class="mt-4 p-4 border rounded-lg bg-blue-50">
                        <p class="font-semibold">Dr. Chemutai (5 min ago)</p>
                        <p class="text-sm">Reminder: Tomorrow's lecture on Pediatrics is moved to room B-201.</p>
                    </div>
                </div>
            </section>


            <!-- Profile Tab Content -->
            <section id="profile-tab" class="tab-content space-y-6">
                <h2 class="text-3xl font-extrabold text-gray-900 mb-4">Student Profile</h2>

                <div class="bg-white p-8 rounded-xl shadow-md max-w-2xl">
                    <div class="flex items-center space-x-4 mb-6">
                        <div class="w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center text-3xl font-bold text-emerald-600">
                            S
                        </div>
                        <div>
                            <p class="text-2xl font-bold text-gray-900">Sarah Johnson</p>
                            <p class="text-md text-gray-500">Nursing Diploma - Cohort 2023</p>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <h3 class="text-xl font-semibold text-gray-800 border-b pb-2 mb-4">Contact Information</h3>
                        <div class="grid grid-cols-2 gap-4 text-gray-700">
                            <div>
                                <p class="text-sm font-medium text-gray-500">Email Address</p>
                                <p class="font-medium">sarah.johnson@nchsm.edu</p>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-500">Phone Number</p>
                                <p class="font-medium">+254 712 345 678</p>
                            </div>
                        </div>

                        <h3 class="text-xl font-semibold text-gray-800 border-b pb-2 pt-4 mb-4">Academic Details</h3>
                        <div class="grid grid-cols-2 gap-4 text-gray-700">
                            <div>
                                <p class="text-sm font-medium text-gray-500">Student ID</p>
                                <p class="font-medium">NCHSM-9001</p>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-500">Current GPA</p>
                                <p class="font-medium">3.85</p>
                            </div>
                        </div>
                    </div>

                    <button class="mt-8 px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition-colors duration-200">
                        Edit Profile
                    </button>
                </div>
            </section>
        </main>
    </div>
</body>
</html>
