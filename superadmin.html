<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NCHSM Super Admin Dashboard</title>
<style>
body { margin:0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #F8FAFC; }
.container { display:flex; min-height:100vh; }
.sidebar { width:220px; background:#1E293B; color:#fff; display:flex; flex-direction:column; padding:20px; }
.sidebar-header { text-align:center; margin-bottom:30px; }
.sidebar-header img { width:60px; margin-bottom:10px; }
.nav { list-style:none; padding:0; flex-grow:1; }
.nav li { margin:10px 0; }
.nav a { color:#fff; text-decoration:none; padding:10px; border-radius:6px; display:block; transition:0.2s; }
.nav a:hover, .nav a.active { background:#3B82F6; }
.logout { margin-top:auto; text-align:center; }
.logout a { display:inline-block; margin-top:20px; padding:10px 20px; background:#EF4444; color:#fff; text-decoration:none; border-radius:6px; }
.main { flex:1; padding:20px 30px; overflow-y:auto; }
header h1 { margin:0; font-size:2rem; }
.subtitle { color:#475569; margin-bottom:20px; }
table { width:100%; border-collapse:collapse; margin-bottom:20px; background:#fff; border-radius:8px; overflow:hidden; }
th, td { padding:12px; border-bottom:1px solid #E2E8F0; text-align:left; }
th { background:#E2E8F0; }
tr:hover { background:#F1F5F9; }
form input, form select, form button, form textarea { padding:8px 12px; margin:5px 5px 10px 0; border-radius:6px; border:1px solid #CBD5E1; }
form button { background:#3B82F6; color:#fff; cursor:pointer; }
form button:hover { background:#2563EB; }
.flex { display:flex; gap:5px; }
.tab-content { display:none; }
.tab-content.active { display:block; }
.cards { display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:20px; margin-bottom:30px; }
.card { background:#fff; padding:20px; border-radius:12px; cursor:pointer; box-shadow:0 2px 8px rgba(0,0,0,0.05); transition: transform 0.2s, box-shadow 0.2s; }
.card:hover { transform:translateY(-5px); box-shadow:0 6px 20px rgba(0,0,0,0.1); }
.card h3 { margin-top:0; }
</style>
</head>
<body>
<div class="container">
<aside class="sidebar">
  <div class="sidebar-header">
    <img src="images/Logo_NCHSM.png" alt="Logo">
    <h2>NCHSM Admin</h2>
    <p id="sessionInfo"></p>
  </div>
  <ul class="nav">
    <li><a href="#" data-tab="dashboard" class="active">Dashboard</a></li>
    <li><a href="#" data-tab="users">Users</a></li>
    <li><a href="#" data-tab="students">Students</a></li>
    <li><a href="#" data-tab="courses">Courses</a></li>
    <li><a href="#" data-tab="attendance">Attendance</a></li>
    <li><a href="#" data-tab="exams">Exams</a></li>
    <li><a href="#" data-tab="messages">Messages</a></li>
    <li><a href="#" data-tab="resources">Resources</a></li>
    <li><a href="#" data-tab="pending">Pending</a></li>
  </ul>
  <div class="logout"><a href="#" onclick="logout()">Logout</a></div>
</aside>
<main class="main">
<header>
  <h1>Welcome, Super Admin!</h1>
  <p class="subtitle">Manage all aspects of NCHSM</p>
</header>

<!-- Dashboard -->
<section id="dashboard" class="tab-content active">
  <div class="cards">
    <div class="card" onclick="showSection('users')"><h3>Manage Users</h3></div>
    <div class="card" onclick="showSection('students')"><h3>Manage Students</h3></div>
    <div class="card" onclick="showSection('courses')"><h3>Courses</h3></div>
    <div class="card" onclick="showSection('attendance')"><h3>Attendance</h3></div>
    <div class="card" onclick="showSection('exams')"><h3>Exams</h3></div>
    <div class="card" onclick="showSection('messages')"><h3>Messages</h3></div>
    <div class="card" onclick="showSection('resources')"><h3>Resources</h3></div>
    <div class="card" onclick="showSection('pending')"><h3>Pending Approvals</h3></div>
  </div>
  <div>
    <p>Total Users: <span id="totalUsers">0</span></p>
    <p>Total Admins: <span id="totalAdmins">0</span></p>
    <p>Total Students: <span id="totalStudents">0</span></p>
    <p>Pending Approval: <span id="totalPending">0</span></p>
  </div>
</section>

<!-- Users -->
<section id="users" class="tab-content">
<h2>Users</h2>
<form id="addUserForm">
<input type="text" id="new_full_name" placeholder="Full Name" required>
<input type="email" id="new_email" placeholder="Email" required>
<input type="text" id="new_phone" placeholder="Phone" required>
<input type="password" id="new_password" placeholder="Password" required>
<select id="new_role" required>
<option value="student">Student</option>
<option value="admin">Admin</option>
<option value="superadmin">Super Admin</option>
</select>
<button type="submit">Add User</button>
</form>
<table>
<thead><tr><th>Name</th><th>Email</th><th>Phone</th><th>Role</th><th>Approved</th><th>Actions</th></tr></thead>
<tbody id="usersTable"></tbody>
</table>
</section>

<!-- Students -->
<section id="students" class="tab-content">
<h2>Students</h2>
<table>
<thead><tr><th>Name</th><th>Email</th><th>Phone</th><th>Status</th><th>Actions</th></tr></thead>
<tbody id="studentsTable"></tbody>
</table>
</section>

<!-- Courses -->
<section id="courses" class="tab-content">
<h2>Courses</h2>
<form id="addCourseForm">
<input type="text" id="course_name" placeholder="Course Name" required>
<input type="text" id="course_description" placeholder="Description">
<button type="submit">Add Course</button>
</form>
<table>
<thead><tr><th>Course</th><th>Actions</th></tr></thead>
<tbody id="coursesTable"></tbody>
</table>
</section>

<!-- Attendance -->
<section id="attendance" class="tab-content">
<h2>Attendance</h2>
<form id="addAttendanceForm">
<select id="att_student_id" required></select>
<select id="att_session_type" required>
<option value="classroom">Classroom</option>
<option value="clinical">Clinical</option>
</select>
<select id="att_course_id" required></select>
<input type="text" id="att_location" placeholder="Location" required>
<input type="date" id="att_date" required>
<input type="time" id="att_time" required>
<button type="submit">Mark Attendance</button>
</form>
<table>
<thead><tr><th>Student</th><th>Type</th><th>Course</th><th>Location/Time</th><th>Date</th><th>Actions</th></tr></thead>
<tbody id="attendanceTable"></tbody>
</table>
</section>

<!-- Exams -->
<section id="exams" class="tab-content">
<h2>Exams</h2>
<form id="addExamForm">
<select id="exam_course_id" required></select>
<input type="text" id="exam_title" placeholder="Exam Title" required>
<input type="date" id="exam_date" required>
<input type="text" id="exam_status" placeholder="Status" required>
<button type="submit">Add Exam</button>
</form>
<table>
<thead><tr><th>Course</th><th>Title</th><th>Date</th><th>Status</th><th>Actions</th></tr></thead>
<tbody id="examsTable"></tbody>
</table>
</section>

<!-- Messages -->
<section id="messages" class="tab-content">
<h2>Messages</h2>
<form id="sendMessageForm">
<input type="email" id="msg_recipient" placeholder="Recipient Email" required>
<textarea id="msg_body" placeholder="Message" required></textarea>
<button type="submit">Send Message</button>
</form>
<table>
<thead><tr><th>From</th><th>To</th><th>Message</th><th>Date</th></tr></thead>
<tbody id="messagesTable"></tbody>
</table>
</section>

<!-- Resources -->
<section id="resources" class="tab-content">
<h2>Resources</h2>
<input type="file" id="resourceFile">
<input type="text" id="resourceTitle" placeholder="Title (optional)">
<button id="uploadResourceBtn">Upload</button>
<table>
<thead><tr><th>File</th><th>Size</th><th>Actions</th></tr></thead>
<tbody id="resourcesTable"></tbody>
</table>
</section>

<!-- Pending -->
<section id="pending" class="tab-content">
<h2>Pending Approvals</h2>
<table>
<thead><tr><th>Name</th><th>Email</th><th>Actions</th></tr></thead>
<tbody id="pendingTable"></tbody>
</table>
</section>
</main>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// ---------------- SUPABASE INIT ----------------
const SUPABASE_URL = 'https://lwhtjozfsmbyihenfunw.supabase.co';
const SUPABASE_ANON_KEY = 'YOUR_ANON_KEY';
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// ---------------- HELPERS ----------------
function $(id){ return document.getElementById(id); }
function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }
function setActiveNav(el){ document.querySelectorAll('.nav a').forEach(a=>a.classList.remove('active')); if(el) el.classList.add('active'); }
function showSection(id,el){ document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active')); $(id)?.classList.add('active'); if(el) setActiveNav(el); }
document.querySelectorAll('.nav a').forEach(link=>{ link.addEventListener('click', e=>{ e.preventDefault(); showSection(link.dataset.tab, link); }); });

// ---------------- AUTH ----------------
(async function(){ const {data:{user}} = await sb.auth.getUser(); if(!user) window.location.href='/login.html'; else $('#sessionInfo')?.innerText = `Signed in as ${user.email}`; })();
async function logout(){ await sb.auth.signOut(); window.location.href='/login.html'; }

// ---------------- DASHBOARD ----------------
async function loadDashboard(){ const {data:users} = await sb.from('profiles').select('*'); if(!users) return;
$('#totalUsers').innerText = users.length;
$('#totalAdmins').innerText = users.filter(u=>u.role==='admin').length;
$('#totalStudents').innerText = users.filter(u=>u.role==='student').length;
$('#totalPending').innerText = users.filter(u=>!u.approved).length; }

// ---------------- USERS ----------------
async function loadUsers(){ const table=$('usersTable'); if(!table) return; const {data:users} = await sb.from('profiles').select('*').order('created_at',{ascending:false}); table.innerHTML=''; users?.forEach(u=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${escapeHtml(u.full_name)}</td><td>${escapeHtml(u.email)}</td><td>${escapeHtml(u.phone)}</td><td>${escapeHtml(u.role)}</td><td>${u.approved?'Yes':'No'}</td><td class="flex">${!u.approved?`<button onclick="approveUser('${u.id}')">Approve</button>`:''}<button onclick="deleteUser('${u.id}')">Delete</button></td>`; table.appendChild(tr); }); }
async function approveUser(id){ await sb.from('profiles').update({approved:true}).eq('id',id); loadUsers(); loadDashboard(); }
async function deleteUser(id){ if(confirm('Delete this user?')){ await sb.from('profiles').delete().eq('id',id); loadUsers(); loadDashboard(); } }
$('#addUserForm')?.addEventListener('submit', async e=>{ e.preventDefault(); const full_name=$('new_full_name').value,email=$('new_email').value,phone=$('new_phone').value,password=$('new_password').value,role=$('new_role').value; const {data,error} = await sb.auth.admin.createUser({email,password,phone,role,app_metadata:{role}}); if(error){ alert(error.message); return; } await sb.from('profiles').insert([{id:data.user.id,full_name,email,phone,role,approved:true}]); $('addUserForm').reset(); loadUsers(); loadDashboard(); });

// ---------------- STUDENTS ----------------
async function loadStudents(){ const table=$('studentsTable'); if(!table) return; const {data:students} = await sb.from('profiles').select('*').eq('role','student').order('created_at',{ascending:false}); table.innerHTML=''; students?.forEach(s=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${escapeHtml(s.full_name)}</td><td>${escapeHtml(s.email)}</td><td>${escapeHtml(s.phone)}</td><td>${s.approved?'Active':'Pending'}</td><td><button onclick="deleteUser('${s.id}')">Delete</button></td>`; table.appendChild(tr); }); }

// ---------------- COURSES ----------------
async function loadCourses(){ const table=$('coursesTable'); if(!table) return; const {data:courses} = await sb.from('courses').select('*').order('created_at',{ascending:false}); table.innerHTML=''; courses?.forEach(c=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${escapeHtml(c.course_name)}</td><td><button onclick="deleteCourse('${c.id}')">Delete</button></td>`; table.appendChild(tr); }); }
async function deleteCourse(id){ if(confirm('Delete course?')){ await sb.from('courses').delete().eq('id',id); loadCourses(); } }
$('#addCourseForm')?.addEventListener('submit', async e=>{ e.preventDefault(); const course_name=$('course_name').value,course_description=$('course_description').value; await sb.from('courses').insert([{course_name,description:course_description}]); $('addCourseForm').reset(); loadCourses(); });

// ---------------- ATTENDANCE ----------------
async function loadAttendance(){ const table=$('attendanceTable'); if(!table) return; const {data:att}=await sb.from('attendance').select('*,profiles(full_name),courses(course_name)').order('created_at',{ascending:false}); table.innerHTML=''; att?.forEach(a=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${escapeHtml(a.profiles?.full_name)}</td><td>${escapeHtml(a.session_type)}</td><td>${escapeHtml(a.courses?.course_name)}</td><td>${escapeHtml(a.location)} / ${escapeHtml(a.time)}</td><td>${escapeHtml(a.date)}</td><td><button onclick="deleteAttendance('${a.id}')">Delete</button></td>`; table.appendChild(tr); }); }
async function deleteAttendance(id){ if(confirm('Delete attendance?')){ await sb.from('attendance').delete().eq('id',id); loadAttendance(); } }

// ---------------- EXAMS ----------------
async function loadExams(){ const table=$('examsTable'); if(!table) return; const {data:exams}=await sb.from('exams').select('*,courses(course_name)').order('date',{ascending:true}); table.innerHTML=''; exams?.forEach(e=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${escapeHtml(e.courses?.course_name)}</td><td>${escapeHtml(e.title)}</td><td>${escapeHtml(e.date)}</td><td>${escapeHtml(e.status)}</td><td><button onclick="deleteExam('${e.id}')">Delete</button></td>`; table.appendChild(tr); }); }
async function deleteExam(id){ if(confirm('Delete exam?')){ await sb.from('exams').delete().eq('id',id); loadExams(); } }
$('#addExamForm')?.addEventListener('submit', async e=>{ e.preventDefault(); const course_id=$('exam_course_id').value,title=$('exam_title').value,date=$('exam_date').value,status=$('exam_status').value; await sb.from('exams').insert([{course_id,title,date,status}]); $('addExamForm').reset(); loadExams(); });

// ---------------- MESSAGES ----------------
async function loadMessages(){ const table=$('messagesTable'); if(!table) return; const {data:msgs}=await sb.from('messages').select('*,profiles_from:sender(*),profiles_to:recipient(*)').order('created_at',{ascending:false}); table.innerHTML=''; msgs?.forEach(m=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${escapeHtml(m.profiles_from?.full_name)}</td><td>${escapeHtml(m.profiles_to?.full_name)}</td><td>${escapeHtml(m.message)}</td><td>${escapeHtml(m.created_at)}</td>`; table.appendChild(tr); }); }
$('#sendMessageForm')?.addEventListener('submit', async e=>{ e.preventDefault(); const recipient_email=$('msg_recipient').value,message=$('msg_body').value; const {data:recipient}=await sb.from('profiles').select('*').eq('email',recipient_email).single(); if(!recipient){ alert('Recipient not found'); return; } await sb.from('messages').insert([{sender:(await sb.auth.getUser()).data.user.id,recipient:recipient.id,message}]); $('sendMessageForm').reset(); loadMessages(); });

// ---------------- RESOURCES ----------------
const RESOURCES_BUCKET='resources';
async function loadResources(){ const table=$('resourcesTable'); if(!table) return; const {data:files}=await sb.storage.from(RESOURCES_BUCKET).list(''); table.innerHTML=''; files?.forEach(f=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td><a href="${sb.storage.from(RESOURCES_BUCKET).getPublicUrl(f.name).data.publicUrl}" target="_blank">${escapeHtml(f.name)}</a></td><td>${(f.size/1024).toFixed(1)} KB</td><td><button onclick="deleteResource('${f.name}')">Delete</button></td>`; table.appendChild(tr); }); }
$('#uploadResourceBtn')?.addEventListener('click', async ()=>{ const file=$('resourceFile').files[0]; if(!file){ alert('Select a file'); return; } await sb.storage.from(RESOURCES_BUCKET).upload(file.name,file,{upsert:true}); $('resourceFile').value=''; $('resourceTitle').value=''; loadResources(); });
async function deleteResource(name){ if(confirm('Delete resource?')){ await sb.storage.from(RESOURCES_BUCKET).remove([name]); loadResources(); } }

// ---------------- PENDING ----------------
async function loadPending(){ const table=$('pendingTable'); if(!table) return; const {data:users}=await sb.from('profiles').select('*').eq('approved',false); table.innerHTML=''; users?.forEach(u=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${escapeHtml(u.full_name)}</td><td>${escapeHtml(u.email)}</td><td><button onclick="approveUser('${u.id}')">Approve</button> <button onclick="deleteUser('${u.id}')">Delete</button></td>`; table.appendChild(tr); }); }

// ---------------- INIT ----------------
(async function(){ loadDashboard(); loadUsers(); loadStudents(); loadCourses(); loadAttendance(); loadExams(); loadMessages(); loadResources(); loadPending(); })();
</script>
</body>
</html>
