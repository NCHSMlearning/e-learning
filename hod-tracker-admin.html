<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Admin - HOD Tracker Management</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="hod-tracker-admin.css">
</head>
<body>
    <div class="admin-container">
        <!-- Admin Header -->
        <div class="admin-header">
            <div class="admin-header-left">
                <h1>üìã HOD Tracker Management System</h1>
                <p>Super Admin Dashboard | Nakuru College of Health Science and Management</p>
            </div>
            <div class="admin-header-right">
                <div class="admin-user-info">
                    <span id="adminName">Super Administrator</span>
                    <button class="btn btn-danger" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>

        <!-- Navigation Sidebar -->
        <div class="admin-sidebar">
            <div class="sidebar-header">
                <img src="https://raw.githubusercontent.com/NCHSMlearning/e-learning/main/images/Logo_NCHSM.png" 
                     alt="NCHSM Logo" class="sidebar-logo">
                <h3>Admin Navigation</h3>
            </div>
            
            <nav class="sidebar-nav">
                <a href="#dashboard" class="nav-link active" onclick="showSection('dashboard')">
                    <i class="nav-icon">üìä</i> Dashboard Overview
                </a>
                <a href="#trackers" class="nav-link" onclick="showSection('trackers')">
                    <i class="nav-icon">üë•</i> All HOD Trackers
                </a>
                <a href="#departments" class="nav-link" onclick="showSection('departments')">
                    <i class="nav-icon">üè¢</i> Department Overview
                </a>
                <a href="#templates" class="nav-link" onclick="showSection('templates')">
                    <i class="nav-icon">üìù</i> Task Templates
                </a>
                <a href="#reports" class="nav-link" onclick="showSection('reports')">
                    <i class="nav-icon">üìà</i> Reports & Analytics
                </a>
                <a href="#settings" class="nav-link" onclick="showSection('settings')">
                    <i class="nav-icon">‚öôÔ∏è</i> Settings
                </a>
            </nav>
            
            <div class="sidebar-footer">
                <div class="quick-stats">
                    <div class="quick-stat">
                        <span class="stat-value" id="quickActiveHods">0</span>
                        <span class="stat-label">Active HODs</span>
                    </div>
                    <div class="quick-stat">
                        <span class="stat-value" id="quickAvgProgress">0%</span>
                        <span class="stat-label">Avg Progress</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="admin-main">
            <!-- Dashboard Overview -->
            <section id="dashboard" class="admin-section active">
                <div class="section-header">
                    <h2>üìä Dashboard Overview</h2>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="refreshDashboard()">
                            <i class="icon">‚Üª</i> Refresh Data
                        </button>
                        <button class="btn btn-secondary" onclick="exportAllTrackers()">
                            <i class="icon">üì§</i> Export All Data
                        </button>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="summary-cards">
                    <div class="summary-card">
                        <div class="summary-card-header">
                            <h3>Total HODs</h3>
                            <i class="card-icon">üë•</i>
                        </div>
                        <div class="summary-card-value" id="totalHods">0</div>
                        <div class="summary-card-trend">
                            <span id="hodTrend">0 this month</span>
                        </div>
                    </div>
                    
                    <div class="summary-card">
                        <div class="summary-card-header">
                            <h3>Overall Progress</h3>
                            <i class="card-icon">üìà</i>
                        </div>
                        <div class="summary-card-value" id="overallProgress">0%</div>
                        <div class="summary-card-trend">
                            <div class="progress-bar small">
                                <div class="progress-fill" id="overallProgressBar"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="summary-card">
                        <div class="summary-card-header">
                            <h3>Tasks Completed</h3>
                            <i class="card-icon">‚úÖ</i>
                        </div>
                        <div class="summary-card-value" id="totalTasksCompleted">0/0</div>
                        <div class="summary-card-trend">
                            <span id="completionRate">0% completion</span>
                        </div>
                    </div>
                    
                    <div class="summary-card">
                        <div class="summary-card-header">
                            <h3>Overdue Tasks</h3>
                            <i class="card-icon">‚ö†Ô∏è</i>
                        </div>
                        <div class="summary-card-value" id="overdueTasks">0</div>
                        <div class="summary-card-trend">
                            <span id="overdueTrend">0 critical</span>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="charts-section">
                    <div class="chart-container">
                        <h3>Progress by Department</h3>
                        <canvas id="departmentProgressChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Completion Rate Timeline</h3>
                        <canvas id="timelineChart"></canvas>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="activity-section">
                    <h3>Recent Activity</h3>
                    <div class="activity-list" id="recentActivity">
                        <div class="activity-item">
                            <div class="activity-icon">üìù</div>
                            <div class="activity-content">
                                <strong>John Doe</strong> updated Nursing Department tracker
                                <small>2 minutes ago</small>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- All HOD Trackers -->
            <section id="trackers" class="admin-section">
                <div class="section-header">
                    <h2>üë• All HOD Trackers</h2>
                    <div class="section-actions">
                        <div class="search-box">
                            <input type="text" id="trackerSearch" 
                                   placeholder="Search HODs..." 
                                   onkeyup="searchTrackers()">
                            <i class="search-icon">üîç</i>
                        </div>
                        <button class="btn btn-primary" onclick="addNewHod()">
                            <i class="icon">+</i> Add New HOD
                        </button>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filters-bar">
                    <div class="filter-group">
                        <label>Department:</label>
                        <select id="deptFilter" onchange="filterTrackers()">
                            <option value="">All Departments</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Progress:</label>
                        <select id="progressFilter" onchange="filterTrackers()">
                            <option value="">All</option>
                            <option value="0-25">0-25%</option>
                            <option value="26-50">26-50%</option>
                            <option value="51-75">51-75%</option>
                            <option value="76-100">76-100%</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Status:</label>
                        <select id="statusFilter" onchange="filterTrackers()">
                            <option value="">All</option>
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                            <option value="overdue">Overdue</option>
                        </select>
                    </div>
                </div>

                <!-- Trackers Table -->
                <div class="table-container">
                    <table class="data-table" id="trackersTable">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAll" onclick="toggleSelectAll()">
                                </th>
                                <th>HOD Name</th>
                                <th>Department</th>
                                <th>Email</th>
                                <th>Progress</th>
                                <th>Days Left</th>
                                <th>Last Updated</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="trackersList">
                            <!-- Will be populated -->
                        </tbody>
                    </table>
                </div>

                <!-- Bulk Actions -->
                <div class="bulk-actions" id="bulkActions" style="display: none;">
                    <div class="bulk-actions-content">
                        <span id="selectedCount">0 items selected</span>
                        <div class="bulk-buttons">
                            <button class="btn btn-secondary" onclick="sendBulkNotification()">
                                <i class="icon">üìß</i> Send Reminder
                            </button>
                            <button class="btn btn-secondary" onclick="bulkUpdateStatus()">
                                <i class="icon">üîÑ</i> Update Status
                            </button>
                            <button class="btn btn-danger" onclick="deleteSelectedTrackers()">
                                <i class="icon">üóëÔ∏è</i> Delete Selected
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="pagination" id="pagination">
                    <button class="pagination-btn" onclick="previousPage()">‚Äπ Previous</button>
                    <div class="page-numbers" id="pageNumbers"></div>
                    <button class="pagination-btn" onclick="nextPage()">Next ‚Ä∫</button>
                </div>
            </section>

            <!-- Department Overview -->
            <section id="departments" class="admin-section">
                <div class="section-header">
                    <h2>üè¢ Department Overview</h2>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="addDepartment()">
                            <i class="icon">+</i> Add Department
                        </button>
                    </div>
                </div>

                <!-- Department Cards -->
                <div class="department-cards" id="departmentCards">
                    <!-- Will be populated -->
                </div>

                <!-- Department Comparison -->
                <div class="comparison-section">
                    <h3>Department Comparison</h3>
                    <canvas id="departmentComparisonChart"></canvas>
                </div>
            </section>

            <!-- Task Templates -->
            <section id="templates" class="admin-section">
                <div class="section-header">
                    <h2>üìù Task Template Management</h2>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="createNewTemplate()">
                            <i class="icon">+</i> Create Template
                        </button>
                        <button class="btn btn-secondary" onclick="importTemplate()">
                            <i class="icon">üì•</i> Import Template
                        </button>
                    </div>
                </div>

                <!-- Template Categories -->
                <div class="template-categories">
                    <div class="category-tabs">
                        <button class="category-tab active" onclick="showTemplateCategory('all')">All Templates</button>
                        <button class="category-tab" onclick="showTemplateCategory('week1-2')">Week 1-2</button>
                        <button class="category-tab" onclick="showTemplateCategory('week3-4')">Week 3-4</button>
                        <button class="category-tab" onclick="showTemplateCategory('week5-6')">Week 5-6</button>
                        <button class="category-tab" onclick="showTemplateCategory('week7-8')">Week 7-8</button>
                        <button class="category-tab" onclick="showTemplateCategory('week9-10')">Week 9-10</button>
                        <button class="category-tab" onclick="showTemplateCategory('week11-13')">Week 11-13</button>
                    </div>
                </div>

                <!-- Templates Grid -->
                <div class="templates-grid" id="templatesGrid">
                    <!-- Will be populated -->
                </div>
            </section>

            <!-- Reports & Analytics -->
            <section id="reports" class="admin-section">
                <div class="section-header">
                    <h2>üìà Reports & Analytics</h2>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="generateComprehensiveReport()">
                            <i class="icon">üìä</i> Generate Full Report
                        </button>
                        <button class="btn btn-secondary" onclick="exportAnalytics()">
                            <i class="icon">üì§</i> Export Analytics
                        </button>
                    </div>
                </div>

                <!-- Report Types -->
                <div class="report-types">
                    <div class="report-card" onclick="generateProgressReport()">
                        <div class="report-card-icon">üìà</div>
                        <h3>Progress Report</h3>
                        <p>Overall completion rates and trends</p>
                    </div>
                    <div class="report-card" onclick="generateDepartmentReport()">
                        <div class="report-card-icon">üè¢</div>
                        <h3>Department Report</h3>
                        <p>Performance by department</p>
                    </div>
                    <div class="report-card" onclick="generateTaskReport()">
                        <div class="report-card-icon">‚úÖ</div>
                        <h3>Task Analysis</h3>
                        <p>Task completion statistics</p>
                    </div>
                    <div class="report-card" onclick="generateTimelineReport()">
                        <div class="report-card-icon">üìÖ</div>
                        <h3>Timeline Report</h3>
                        <p>Progress over time</p>
                    </div>
                </div>

                <!-- Custom Report Generator -->
                <div class="custom-report">
                    <h3>Custom Report Generator</h3>
                    <div class="report-form">
                        <div class="form-group">
                            <label>Report Type:</label>
                            <select id="reportType">
                                <option value="summary">Summary Report</option>
                                <option value="detailed">Detailed Report</option>
                                <option value="comparative">Comparative Report</option>
                                <option value="predictive">Predictive Analysis</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Date Range:</label>
                            <div class="date-range">
                                <input type="date" id="reportStartDate">
                                <span>to</span>
                                <input type="date" id="reportEndDate">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Departments:</label>
                            <div class="department-checkboxes" id="reportDepts"></div>
                        </div>
                        <button class="btn btn-primary" onclick="generateCustomReport()">
                            Generate Custom Report
                        </button>
                    </div>
                </div>
            </section>

            <!-- Settings -->
            <section id="settings" class="admin-section">
                <div class="section-header">
                    <h2>‚öôÔ∏è Settings</h2>
                </div>

                <!-- Settings Tabs -->
                <div class="settings-tabs">
                    <button class="settings-tab active" onclick="showSettingsTab('general')">General</button>
                    <button class="settings-tab" onclick="showSettingsTab('notifications')">Notifications</button>
                    <button class="settings-tab" onclick="showSettingsTab('users')">User Management</button>
                    <button class="settings-tab" onclick="showSettingsTab('integrations')">Integrations</button>
                    <button class="settings-tab" onclick="showSettingsTab('backup')">Backup & Restore</button>
                </div>

                <!-- Settings Content -->
                <div class="settings-content">
                    <div id="generalSettings" class="settings-tab-content active">
                        <h3>General Settings</h3>
                        <div class="settings-form">
                            <div class="form-group">
                                <label>Default Task Duration (days):</label>
                                <input type="number" id="defaultDuration" value="90" min="30" max="365">
                            </div>
                            <div class="form-group">
                                <label>Reminder Frequency:</label>
                                <select id="reminderFrequency">
                                    <option value="daily">Daily</option>
                                    <option value="weekly" selected>Weekly</option>
                                    <option value="biweekly">Bi-weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Progress Calculation Method:</label>
                                <select id="progressMethod">
                                    <option value="taskCount">Task Count</option>
                                    <option value="weighted" selected>Weighted Tasks</option>
                                    <option value="kpi">KPI-Based</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="saveGeneralSettings()">Save Settings</button>
                        </div>
                    </div>

                    <div id="userManagement" class="settings-tab-content">
                        <h3>User Management</h3>
                        <div class="users-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Department</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersList">
                                    <!-- Will be populated -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Modals -->
    <div id="editTrackerModal" class="modal">
        <div class="modal-content">
            <!-- Modal content will be loaded dynamically -->
        </div>
    </div>
    <!-- Real-time Edit Modal -->
<div id="realTimeEditModal" class="modal" style="display: none;">
    <div class="modal-overlay" onclick="closeRealTimeEditModal()"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>üéØ Edit HOD Tracker</h3>
            <button class="modal-close" onclick="closeRealTimeEditModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="edit-info">
                <div class="edit-hod-info">
                    <strong id="editHodName">John Doe</strong>
                    <span class="edit-dept" id="editHodDept">Department</span>
                </div>
                <div class="edit-status">
                    <span class="status-badge" id="editCurrentStatus">Active</span>
                    <span class="edit-progress">Progress: <span id="editCurrentProgress">50%</span></span>
                </div>
            </div>
            
            <div class="edit-form">
                <div class="form-group">
                    <label>Progress (%)</label>
                    <div class="progress-input-group">
                        <input type="range" id="editProgressInput" min="0" max="100" value="50" 
                               oninput="updateEditProgressValue(this.value)">
                        <div class="progress-display">
                            <span id="editProgressValue">50%</span>
                            <div class="progress-preview">
                                <div class="progress-bar small">
                                    <div class="progress-fill" id="editProgressPreview" style="width: 50%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Status</label>
                    <div class="status-options">
                        <label class="status-option">
                            <input type="radio" name="editStatus" value="active" checked>
                            <span class="status-dot active"></span>
                            <span>Active</span>
                        </label>
                        <label class="status-option">
                            <input type="radio" name="editStatus" value="completed">
                            <span class="status-dot completed"></span>
                            <span>Completed</span>
                        </label>
                        <label class="status-option">
                            <input type="radio" name="editStatus" value="overdue">
                            <span class="status-dot overdue"></span>
                            <span>Overdue</span>
                        </label>
                        <label class="status-option">
                            <input type="radio" name="editStatus" value="not-started">
                            <span class="status-dot not-started"></span>
                            <span>Not Started</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Tasks Completed</label>
                    <div class="tasks-input">
                        <input type="number" id="editTasksCompleted" min="0" value="0" 
                               placeholder="Completed tasks">
                        <span>out of</span>
                        <input type="number" id="editTotalTasks" min="1" value="10" 
                               placeholder="Total tasks">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Admin Notes</label>
                    <textarea id="editAdminNotes" rows="3" 
                              placeholder="Add notes about this update..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Update Display Pages</label>
                    <div class="update-options">
                        <label>
                            <input type="checkbox" id="updateLiveDisplay" checked>
                            <span>Update live display in real-time</span>
                        </label>
                        <label>
                            <input type="checkbox" id="sendNotification" checked>
                            <span>Send notification to HOD</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeRealTimeEditModal()">Cancel</button>
            <button class="btn btn-primary" onclick="saveRealTimeEdit()">
                üíæ Save Changes & Sync
            </button>
            <button class="btn btn-success" onclick="saveAndViewLive()">
                üëÅÔ∏è Save & View Live
            </button>
        </div>
    </div>
</div>

<!-- Quick Edit Panel -->
<div id="quickEditPanel" class="edit-controls" style="display: none;">
    <h4>Quick Edit</h4>
    <button onclick="quickEditProgress()">
        üìà Edit Progress
    </button>
    <button onclick="quickEditStatus()">
        üè∑Ô∏è Change Status
    </button>
    <button onclick="quickEditTasks()">
        ‚úÖ Update Tasks
    </button>
    <button onclick="openLivePreview()">
        üëÅÔ∏è Live Preview
    </button>
    <hr>
    <button class="btn-danger" onclick="closeQuickEditPanel()">
        ‚úï Close
    </button>
</div>

<!-- Live Preview Window -->
<div id="livePreviewWindow" class="live-preview" style="display: none;">
    <div class="live-preview-header">
        <span>Live Preview</span>
        <button class="dismiss-btn" onclick="closeLivePreview()">&times;</button>
    </div>
    <div class="live-preview-content">
        <iframe id="livePreviewFrame" 
                src="about:blank" 
                style="width: 100%; height: 300px; border: none;">
        </iframe>
        <div class="preview-controls">
            <button onclick="refreshPreview()">üîÑ Refresh</button>
            <button onclick="openPreviewFullscreen()">üì∫ Full Screen</button>
        </div>
    </div>
</div>

<!-- Sync Status Indicator -->
<div id="syncStatus" class="sync-status" style="display: none;">
    <span class="sync-icon">üîÑ</span>
    <span class="sync-text">Syncing...</span>
</div>

<!-- Connection Status -->
<div id="connectionStatus" class="connection-status connected">
    ‚óè Connected
</div>

    <script src="hod-tracker-admin.js"></script>
</body>
</html>
