<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NCHSM Admin Dashboard</title>
  <style>
    body{margin:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background-color:#F8FAFC;}
    .container{display:flex;min-height:100vh;}
    .sidebar{width:220px;background-color:#1E293B;color:#fff;display:flex;flex-direction:column;padding:20px;}
    .sidebar-header{text-align:center;margin-bottom:30px;}
    .sidebar-header img{width:60px;margin-bottom:10px;}
    .nav{list-style:none;padding:0;flex-grow:1;}
    .nav li{margin:10px 0;}
    .nav a{color:#fff;text-decoration:none;padding:10px;border-radius:6px;display:block;transition:0.2s;}
    .nav a:hover,.nav a.active{background-color:#3B82F6;}
    .logout{margin-top:auto;text-align:center;}
    .logout a{display:inline-block;margin-top:20px;padding:10px 20px;background-color:#EF4444;color:#fff;text-decoration:none;border-radius:6px;}
    .main{flex:1;padding:20px 30px;overflow-y:auto;}
    header h1{margin:0;font-size:2rem;}
    .subtitle{color:#475569;margin-bottom:20px;}
    .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:20px;margin-bottom:30px;}
    .card{background-color:#fff;padding:20px;border-radius:12px;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.05);transition:transform 0.2s,box-shadow 0.2s;}
    .card:hover{transform:translateY(-5px);box-shadow:0 6px 20px rgba(0,0,0,0.1);}
    .card h3{margin-top:0;}
    .tab-content{display:none;}
    .tab-content.active{display:block;}
    table{width:100%;border-collapse:collapse;margin-bottom:20px;background-color:#fff;border-radius:8px;overflow:hidden;}
    th,td{padding:12px;border-bottom:1px solid #E2E8F0;text-align:left;}
    th{background-color:#E2E8F0;}
    tr:hover{background-color:#F1F5F9;}
    form input,form select,form button,form textarea{padding:8px 12px;margin:5px 5px 10px 0;border-radius:6px;border:1px solid #CBD5E1;}
    form button{background-color:#3B82F6;color:#fff;cursor:pointer;}
    form button:hover{background-color:#2563EB;}
    #calendar,#messages,#resources{background-color:#fff;padding:20px;border-radius:12px;}
    #calendar table{width:100%;text-align:center;border-collapse:collapse;}
    #calendar th,#calendar td{border:1px solid #E2E8F0;padding:10px;}
    @media(max-width:768px){.container{flex-direction:column}.sidebar{width:100%;flex-direction:row;overflow-x:auto}.main{padding:15px;}}
  </style>
</head>
<body>
<div class="container">
  <aside class="sidebar">
    <div class="sidebar-header">
      <img src="images/Logo_NCHSM.png" alt="Logo">
      <h2>Admin</h2>
      <p id="userName">Loading...</p>
    </div>
    <ul class="nav">
      <li><a href="#" data-tab="dashboard" class="active">Dashboard</a></li>
      <li><a href="#" data-tab="students">Students</a></li>
      <li><a href="#" data-tab="courses">Courses</a></li>
      <li><a href="#" data-tab="attendance">Attendance</a></li>
      <li><a href="#" data-tab="cats">CATS/Exams</a></li>
      <li><a href="#" data-tab="messages">Inbox</a></li>
      <li><a href="#" data-tab="calendar">Calendar</a></li>
      <li><a href="#" data-tab="resources">Resources</a></li>
    </ul>
    <div class="logout"><a href="#" onclick="logout()">Logout</a></div>
  </aside>

  <main class="main">
    <header>
      <h1>Welcome, Admin!</h1>
      <p class="subtitle">Manage all aspects of NCHSM</p>
    </header>

    <!-- Dashboard Cards -->
    <section id="dashboard" class="tab-content active">
      <div class="cards">
        <div class="card" onclick="showTab('students')"><h3>Manage Students</h3></div>
        <div class="card" onclick="showTab('courses')"><h3>Manage Courses</h3></div>
        <div class="card" onclick="showTab('attendance')"><h3>Attendance</h3></div>
        <div class="card" onclick="showTab('cats')"><h3>CATS/Exams</h3></div>
      </div>
    </section>

    <!-- Students Tab -->
    <section id="students" class="tab-content">
      <h2>Students</h2>
      <form id="add-student-form">
        <input type="text" id="student-name" placeholder="Full Name" required>
        <input type="email" id="student-email" placeholder="Email" required>
        <input type="text" id="student-phone" placeholder="Phone" required>
        <button type="submit">Add Student</button>
      </form>
      <table>
        <thead><tr><th>Name</th><th>Email</th><th>Phone</th><th>Approved</th></tr></thead>
        <tbody id="students-table"></tbody>
      </table>
    </section>

    <!-- Courses Tab -->
    <section id="courses" class="tab-content">
      <h2>Courses</h2>
      <form id="add-course-form">
        <input type="text" id="course-name" placeholder="Course Name" required>
        <button type="submit">Add Course</button>
      </form>
      <table>
        <thead><tr><th>Course Name</th></tr></thead>
        <tbody id="courses-table"></tbody>
      </table>
    </section>

    <!-- Attendance Tab -->
    <section id="attendance" class="tab-content">
      <h2>Attendance</h2>
      <table>
        <thead><tr><th>Student</th><th>Session</th><th>Course/Rotation</th><th>Location/Time</th><th>Date</th></tr></thead>
        <tbody id="attendance-table"></tbody>
      </table>
    </section>

    <!-- CATS Tab -->
    <section id="cats" class="tab-content">
      <h2>CATS / Exams</h2>
      <form id="add-exam-form">
        <input type="text" id="exam-name" placeholder="Exam Name" required>
        <input type="date" id="exam-date" required>
        <button type="submit">Add Exam</button>
      </form>
      <table>
        <thead><tr><th>Exam</th><th>Date</th></tr></thead>
        <tbody id="exams-table"></tbody>
      </table>
    </section>

    <!-- Inbox Tab -->
    <section id="messages" class="tab-content">
      <h2>Inbox / Messages</h2>
      <form id="send-message-form">
        <input type="text" id="recipient" placeholder="Recipient ID" required>
        <textarea id="message-content" placeholder="Message" required></textarea>
        <button type="submit">Send</button>
      </form>
      <div id="messages-list"></div>
    </section>

    <!-- Calendar Tab -->
    <section id="calendar" class="tab-content">
      <h2>Calendar</h2>
      <div id="calendar"><p>Simple calendar placeholder</p></div>
    </section>

    <!-- Resource Center -->
    <section id="resources" class="tab-content">
      <h2>Resource Center</h2>
      <form id="upload-resource-form">
        <input type="file" id="resource-file" required>
        <button type="submit">Upload</button>
      </form>
      <div id="resources-list"></div>
    </section>

  </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const SUPABASE_URL = 'https://lwhtjozfsmbyihenfunw.supabase
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx3aHRqb3pmc21ieWloZW5mdW53Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2NTgxMjcsImV4cCI6MjA3NTIzNDEyN30.7Z8AYvPQwTAEEEhODlW6Xk-IR1FK3Uj5ivZS7P17Wpk';
  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // Sidebar navigation
  const navLinks = document.querySelectorAll('.nav a');
  const tabs = document.querySelectorAll('.tab-content');
  navLinks.forEach(link => {
    link.addEventListener('click', e => {
      e.preventDefault();
      navLinks.forEach(l => l.classList.remove('active'));
      link.classList.add('active');
      tabs.forEach(tab => tab.classList.remove('active'));
      document.getElementById(link.dataset.tab).classList.add('active');
    });
  });
  function showTab(tabId) {
    navLinks.forEach(l => l.classList.remove('active'));
    tabs.forEach(tab => tab.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
  }

  // Display Admin Name
  const user = JSON.parse(localStorage.getItem('loggedInUser'));
  if(user) document.getElementById('userName').textContent = user.full_name;

  // =======================
  // Fetch and display students
  // =======================
  async function loadStudents() {
    const { data, error } = await sb.from('profiles').select('*').eq('role','student');
    if (error) console.error(error);
    else {
      const table = document.getElementById('students-table');
      table.innerHTML = '';
      data.forEach(s => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${s.full_name}</td><td>${s.email}</td><td>${s.phone}</td><td>${s.approved}</td>`;
        table.appendChild(row);
      });
    }
  }
  loadStudents();

  // Add student
  const addStudentForm = document.getElementById('add-student-form');
  addStudentForm.addEventListener('submit', async e => {
    e.preventDefault();
    const name = document.getElementById('student-name').value.trim();
    const email = document.getElementById('student-email').value.trim();
    const phone = document.getElementById('student-phone').value.trim();
    if(!name || !email || !phone) return alert('Fill all fields');
    const { data, error } = await sb.from('profiles').insert([{ full_name: name, email, phone, role:'student', approved:true }]);
    if(error) alert(error.message);
    else {
      addStudentForm.reset();
      loadStudents();
    }
  });

  // =======================
  // Fetch and display courses
  // =======================
  async function loadCourses() {
    const { data, error } = await sb.from('courses').select('*');
    if(error) console.error(error);
    else {
      const table = document.getElementById('courses-table');
      table.innerHTML = '';
      data.forEach(c => {
        const row = document.createElement('tr');
        row.innerHTML = `<td>${c.name}</td>`;
        table.appendChild(row);
      });
    }
  }
  loadCourses();

  const addCourseForm = document.getElementById('add-course-form');
  addCourseForm.addEventListener('submit', async e => {
    e.preventDefault();
    const name = document.getElementById('course-name').value.trim();
    if(!name) return alert('Enter course name');
    const { error } = await sb.from('courses').insert([{ name }]);
    if(error) alert(error.message);
    else {
      addCourseForm.reset();
      loadCourses();
    }
  });

  // =======================
  // Messages
  // =======================
  const msgForm = document.getElementById('send-message-form');
  const msgList = document.getElementById('messages-list');
  async function loadMessages() {
    const { data } = await sb.from('messages').select('*');
    msgList.innerHTML = '';
    data.forEach(m => {
      const div = document.createElement('div');
      div.innerHTML = `<strong>To:</strong> ${m.recipient_id}<br>${m.content}<hr>`;
      msgList.appendChild(div);
    });
  }
  loadMessages();

  msgForm.addEventListener('submit', async e => {
    e.preventDefault();
    const recipient = document.getElementById('recipient').value.trim();
    const content = document.getElementById('message-content').value.trim();
    if(!recipient || !content) return alert('Fill all fields');
    const { error } = await sb.from('messages').insert([{ recipient_id: recipient, content }]);
    if(error) alert(error.message);
    else {
      msgForm.reset();
      loadMessages();
    }
  });

  // =======================
  // Logout
  // =======================
  async function logout() {
    await sb.auth.signOut();
    localStorage.removeItem('loggedInUser');
    window.location.href = 'login.html';
  }

  // =======================
  // TODO: Add Attendance, Exams, Resources similar to above
  // =======================

</script>
</body>
</html>
