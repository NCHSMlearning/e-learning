<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>NCHSM Digital Portal | Registration</title>

<link rel="icon" type="image/png" href="https://raw.githubusercontent.com/NCHSMlearning/e-learning/main/images/Logo_NCHSM.png" sizes="32x32" />

<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet" />

<style>
Â  /* --- ULTRA-MODERN CSS VARIABLES (High Contrast & Depth) --- */
Â  :root {
Â  Â  --primary: #0a7aff; /* Electric Blue */
Â  Â  --primary-hover: #0056b3;
Â  Â  --secondary: #7f8c8d;
Â  Â  --bg: #ecf0f3; /* Light, soft background for depth */
Â  Â  --white: #ffffff;
Â  Â  --dark-text: #2c3e50;
Â  Â  --light-shadow: -5px -5px 10px var(--white);
Â  Â  --dark-shadow: 5px 5px 10px rgba(174, 174, 192, 0.4);
Â  Â  --inset-shadow: inset 2px 2px 5px rgba(174, 174, 192, 0.5), inset -5px -5px 10px var(--white);
Â  Â  --error: #e74c3c;
Â  Â  --success: #2ecc71;
Â  }

Â  /* --- Global Reset and Body Styling --- */
Â  * { box-sizing: border-box; }
Â  body {
Â  Â  margin: 0;
Â  Â  font-family: 'Outfit', sans-serif;
Â  Â  background: var(--bg);
Â  Â  display: flex;
Â  Â  align-items: center;
Â  Â  justify-content: center;
Â  Â  min-height: 100vh;
Â  Â  padding: 20px;
Â  Â  color: var(--dark-text);
Â  Â  transition: background 0.3s;
Â  }

Â  /* --- Container (The Soft Embossed Card) --- */
Â  .container {
Â  Â  background: var(--bg);
Â  Â  padding: clamp(2rem, 5vw, 3rem);
Â  Â  border-radius: 25px; /* Softer rounded corners */
Â  Â  box-shadow: var(--dark-shadow), var(--light-shadow); /* Neumorphism base */
Â  Â  max-width: 480px;
Â  Â  width: 100%;
Â  Â  text-align: center;
Â  Â  animation: fadeIn 0.8s cubic-bezier(0.2, 0.8, 0.4, 1) forwards;
Â  }
Â  @keyframes fadeIn { 
Â  Â  from { opacity: 0; transform: scale(0.9) translateY(20px); } 
Â  Â  to { opacity: 1; transform: scale(1) translateY(0); } 
Â  }

Â  /* --- Header Content --- */
Â  img { 
Â  Â  width: 75px; 
Â  Â  margin-bottom: 20px; 
Â  Â  filter: drop-shadow(0 0 5px rgba(0, 0, 0, 0.05));
Â  }
Â  h2 { 
Â  Â  font-weight: 700; 
Â  Â  font-size: 2rem;
Â  Â  margin-bottom: 0.5rem; 
Â  Â  color: var(--dark-text);
Â  }
Â  p.subtitle { 
Â  Â  color: var(--secondary); 
Â  Â  margin-bottom: 2rem; 
Â  Â  font-size: 1.05rem;
Â  }

Â  /* --- Form and Inputs --- */
Â  form { 
Â  Â  display: flex; 
Â  Â  flex-direction: column; 
Â  Â  gap: 1.25rem; 
Â  Â  text-align: left; 
Â  }
Â  .input-group { 
Â  Â  position: relative; 
Â  }
Â  label { 
Â  Â  font-weight: 600; 
Â  Â  font-size: 0.9rem; 
Â  Â  color: var(--dark-text); 
Â  Â  display: block;
Â  Â  margin-bottom: 0.4rem;
Â  Â  text-shadow: 1px 1px 1px var(--white); /* Subtle text depth */
Â  }
Â  input, select { 
Â  Â  padding: 1rem 1.25rem;
Â  Â  border: none;
Â  Â  border-radius: 15px;
Â  Â  font-size: 1rem;
Â  Â  width: 100%;
Â  Â  background-color: var(--bg);
Â  Â  box-shadow: var(--inset-shadow); /* Inset shadow for the 'pressed' look */
Â  Â  transition: all 0.3s ease;
Â  Â  appearance: none;
Â  }
Â  select {
Â  Â  /* Custom arrow style */
Â  Â  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%237f8c8d'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /%3E%3C/svg%3E");
Â  Â  background-repeat: no-repeat;
Â  Â  background-position: right 1.25rem center;
Â  Â  background-size: 1em;
Â  }
Â  input:focus, select:focus { 
Â  Â  box-shadow: 0 0 0 3px var(--primary), var(--inset-shadow); /* Focus ring on top of inset */
Â  Â  outline: none; 
Â  }

Â  /* --- Button --- */
Â  button { 
Â  Â  background: var(--primary); 
Â  Â  color: var(--white); 
Â  Â  border: none; 
Â  Â  border-radius: 15px; 
Â  Â  padding: 1.1rem;
Â  Â  font-weight: 700; 
Â  Â  font-size: 1.15rem; 
Â  Â  cursor: pointer; 
Â  Â  transition: all 0.3s ease; 
Â  Â  margin-top: 1.5rem;
Â  Â  letter-spacing: 1px;
Â  Â  box-shadow: var(--dark-shadow); /* Raised button */
Â  }
Â  button:hover { 
Â  Â  background: var(--primary-hover); 
Â  Â  box-shadow: 0 4px 15px rgba(10, 122, 255, 0.5); /* Stronger blue glow */
Â  Â  transform: translateY(-1px);
Â  }
Â  button:active {
Â  Â  box-shadow: var(--inset-shadow); /* 'Pressed' feeling on click */
Â  Â  transform: translateY(1px);
Â  }
Â  button:disabled { 
Â  Â  background: #bdc3c7; 
Â  Â  color: #f5f7fa;
Â  Â  cursor: not-allowed; 
Â  Â  box-shadow: var(--dark-shadow); 
Â  Â  transform: none;
Â  }

Â  /* --- Messages and Links --- */
Â  .message { 
Â  Â  text-align: center; 
Â  Â  margin-top: 1rem; 
Â  Â  padding: 0.8rem 1rem;
Â  Â  border-radius: 12px;
Â  Â  font-weight: 600; 
Â  Â  box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
Â  Â  animation: messageIn 0.5s ease-out;
Â  }
Â  @keyframes messageIn { 
Â  Â  from { opacity: 0; transform: scale(0.95); } 
Â  Â  to { opacity: 1; transform: scale(1); } 
Â  }
Â  .error { 
Â  Â  color: var(--error); 
Â  Â  background: rgba(231, 76, 60, 0.08);
Â  Â  border: 1px solid var(--error);
Â  }
Â  .success { 
Â  Â  color: var(--success); 
Â  Â  background: rgba(46, 204, 113, 0.08);
Â  Â  border: 1px solid var(--success);
Â  }
Â  .login-link { 
Â  Â  margin-top: 2.5rem; 
Â  Â  color: var(--secondary); 
Â  Â  font-size: 0.95rem; 
Â  Â  font-weight: 400;
Â  }
Â  .login-link a { 
Â  Â  color: var(--primary); 
Â  Â  text-decoration: none; 
Â  Â  font-weight: 700;
Â  Â  border-bottom: 2px solid transparent;
Â  Â  transition: all 0.2s;
Â  }
Â  .login-link a:hover { 
Â  Â  color: var(--primary-hover);
Â  Â  border-bottom: 2px solid var(--primary);
Â  }

Â  /* Dynamic Fields Animation (Re-implemented with Neumorphism) */
Â  #student-fields, #lecturer-fields {
Â  Â  display: grid; /* Use grid for consistent gap in hidden state */
Â  Â  grid-template-columns: 1fr;
Â  Â  gap: 1.25rem;
Â  Â  transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
Â  Â  max-height: 0;
Â  Â  opacity: 0;
Â  Â  overflow: hidden;
Â  Â  padding-top: 0;
Â  }
Â  .visible-fields {
Â  Â  max-height: 300px !important;
Â  Â  opacity: 1 !important;
Â  Â  padding-top: 1.25rem !important;
Â  }

Â  /* Simple Loading Spinner for Button */
Â  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } 
Â  .spinner { 
Â  Â  display: inline-block; 
Â  Â  width: 1.1em; 
Â  Â  height: 1.1em; 
Â  Â  border: 3px solid rgba(255, 255, 255, 0.2); 
Â  Â  border-radius: 50%; 
Â  Â  border-top-color: var(--white); 
Â  Â  animation: spin 0.8s linear infinite; 
Â  Â  margin-right: 8px; 
Â  Â  vertical-align: middle; 
Â  }
</style>
</head>
<body>
<div class="container">
Â  <img src="https://raw.githubusercontent.com/NCHSMlearning/e-learning/main/images/Logo_NCHSM.png" alt="NCHSM Logo" />
Â  <h2>Register Your Account</h2>
Â  <p class="subtitle">Join the **NCHSM Digital Portal** with a secure and seamless experience.</p>

Â  <form id="register-form">
Â  Â  <div class="input-group">
Â  Â  Â  <label for="role">Register As</label>
Â  Â  Â  <select id="role" name="role" required>
Â  Â  Â  Â  <option value="">-- Select Role --</option>
Â  Â  Â  Â  <option value="student">Student</option>
Â  Â  Â  Â  <option value="lecturer">Lecturer</option>
Â  Â  Â  </select>
Â  Â  </div>

Â  Â  <div class="input-group">
Â  Â  Â  <label for="full_name">Full Name</label>
Â  Â  Â  <input type="text" id="full_name" name="full_name" placeholder="Enter your full name" required />
Â  Â  </div>

Â  Â  <div class="input-group">
Â  Â  Â  <label for="email">Email Address</label>
Â  Â  Â  <input type="email" id="email" name="email" placeholder="e.g. name@institution.ac.ke" required />
Â  Â  </div>

Â  Â  Â  Â  <div id="student-fields">
Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  <label for="student_id_number">Admission / Student ID</label>
Â  Â  Â  Â  <input type="text" id="student_id_number" name="student_id_number" placeholder="e.g. NCHSM2025/001" />
Â  Â  Â  </div>
Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  <label for="program_type">Program</label>
Â  Â  Â  Â  <select id="program_type" name="program_type">
Â  Â  Â  Â  Â  <option value="">-- Select Your Program --</option>
Â  Â  Â  Â  Â  <option value="KRCHN">KRCHN Nursing</option>
Â  Â  Â  Â  Â  <option value="TIVET">TIVET Program</option>
Â  Â  Â  Â  </select>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="lecturer-fields">
Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  <label for="staff_id">Staff ID</label>
Â  Â  Â  Â  <input type="text" id="staff_id" name="staff_id" placeholder="e.g. NCHSM-LECT-001" />
Â  Â  Â  </div>
Â  Â  Â  <div class="input-group">
Â  Â  Â  Â  <label for="department">Department</label>
Â  Â  Â  Â  <select id="department" name="department">
Â  Â  Â  Â  Â  <option value="">-- Select Department --</option>
Â  Â  Â  Â  Â  <option value="Nursing">Nursing</option>
Â  Â  Â  Â  Â  <option value="TIVET">TIVET</option>
Â  Â  Â  Â  </select>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div class="input-group">
Â  Â  Â  <label for="phone">Phone Number</label>
Â  Â  Â  <input type="tel" id="phone" name="phone" placeholder="07XXXXXXXX" required />
Â  Â  </div>

Â  Â  <div class="input-group">
Â  Â  Â  <label for="password">Password</label>
Â  Â  Â  <input type="password" id="password" name="password" placeholder="Create a strong password" required />
Â  Â  </div>

Â  Â  <div class="input-group">
Â  Â  Â  <label for="confirm_password">Confirm Password</label>
Â  Â  Â  <input type="password" id="confirm_password" name="confirm_password" placeholder="Confirm your password" required />
Â  Â  </div>

Â  Â  <button type="submit" id="register-btn">ğŸ‰ Register Account</button>
Â  Â  <p id="message" class="message"></p>
Â  </form>

Â  <div class="login-link">
Â  Â  Already have an account? <a href="login.html">Sign In Here</a>
Â  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
Â  // --- JavaScript Logic (Slightly Refined for Better UX) ---

Â  // Supabase config is kept the same
Â  if (window.location.pathname.endsWith('.html')) {
Â  Â  const cleanPath = window.location.pathname.replace(/\.html$/, '');
Â  Â  window.history.replaceState({}, '', cleanPath);
Â  }

Â  const SUPABASE_URL = 'https://lwhtjozfsmbyihenfunw.supabase.co';
Â  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx3aHRqb3pmc21ieWloZW5mdW53Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2NTgxMjcsImV4cCI6MjA3NTIzNDEyN30.7Z8AYvPQwTAEEEhODlW6Xk-IR1FK3Uj5ivZS7P17Wpk';
Â  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

Â  const roleSelect = document.getElementById('role');
Â  const studentFieldsDiv = document.getElementById('student-fields');
Â  const lecturerFieldsDiv = document.getElementById('lecturer-fields');
Â  const studentInputs = studentFieldsDiv.querySelectorAll('input, select');
Â  const lecturerInputs = lecturerFieldsDiv.querySelectorAll('input, select');

Â  const form = document.getElementById('register-form');
Â  const message = document.getElementById('message');
Â  const registerBtn = document.getElementById('register-btn');

Â  // MODIFIED: Use CSS classes for smooth transition
Â  const manageRequiredFields = (role) => {
Â  Â  const isStudent = role === 'student';
Â  Â  const isLecturer = role === 'lecturer';

Â  Â  // Toggle CSS class for smooth show/hide
Â  Â  studentFieldsDiv.classList.toggle('visible-fields', isStudent);
Â  Â  lecturerFieldsDiv.classList.toggle('visible-fields', isLecturer);

Â  Â  // Manage 'required' attribute
Â  Â  studentInputs.forEach(input => input.required = isStudent);
Â  Â  lecturerInputs.forEach(input => input.required = isLecturer);

Â  Â  // Reset values of hidden fields to prevent accidental submission of old data
Â  Â  if (!isStudent) studentInputs.forEach(input => input.value = input.tagName === 'SELECT' ? '' : '');
Â  Â  if (!isLecturer) lecturerInputs.forEach(input => input.value = input.tagName === 'SELECT' ? '' : '');
Â  };

Â  roleSelect.addEventListener('change', () => manageRequiredFields(roleSelect.value));
Â  manageRequiredFields(roleSelect.value); // Initial call

Â  // Supabase Submission Logic
Â  form.addEventListener('submit', async (e) => {
Â  Â  e.preventDefault();
Â  Â  message.textContent = '';
Â  Â  message.className = 'message';
Â  Â  registerBtn.disabled = true;
Â  Â  registerBtn.innerHTML = '<span class="spinner"></span> Processing...'; 

Â  Â  const role = roleSelect.value;
Â  Â  const password = document.getElementById('password').value.trim();
Â  Â  const confirmPassword = document.getElementById('confirm_password').value.trim();

Â  Â  if (password !== confirmPassword) {
Â  Â  Â  message.textContent = 'âŒ Passwords do not match. Please try again.';
Â  Â  Â  message.classList.add('error');
Â  Â  Â  registerBtn.disabled = false;
Â  Â  Â  registerBtn.innerHTML = 'ğŸ‰ Register Account';
Â  Â  Â  return;
Â  Â  }

Â  Â  // Gather data...
Â  Â  const userMetadata = {
Â  Â  Â  full_name: document.getElementById('full_name').value.trim(),
Â  Â  Â  role,
Â  Â  Â  phone: document.getElementById('phone').value.trim(),
Â  Â  Â  // Only include the relevant ID/field if the role is selected. Supabase handles nulls fine.
Â  Â  Â  admission_number: role === 'student' ? document.getElementById('student_id_number').value.trim() : null,
Â  Â  Â  course: role === 'student' ? document.getElementById('program_type').value : null,
Â  Â  Â  staff_id: role === 'lecturer' ? document.getElementById('staff_id').value.trim() : null,
Â  Â  Â  department: role === 'lecturer' ? document.getElementById('department').value : null
Â  Â  };

Â  Â  const email = document.getElementById('email').value.trim();

Â  Â  try {
Â  Â  Â  const { error } = await sb.auth.signUp({
Â  Â  Â  Â  email,
Â  Â  Â  Â  password,
Â  Â  Â  Â  options: { data: userMetadata }
Â  Â  Â  });
Â  
Â  Â  Â  if (error) {
Â  Â  Â  Â  message.textContent = `âŒ Registration failed: ${error.message}`;
Â  Â  Â  Â  message.classList.add('error');
Â  Â  Â  } else {
Â  Â  Â  Â  message.textContent = 'âœ… Success! An email verification link has been sent. Please verify your email and await admin approval.';
Â  Â  Â  Â  message.classList.add('success');
Â  Â  Â  Â  form.reset();
Â  Â  Â  Â  manageRequiredFields(''); // Hide fields after successful reset
Â  Â  Â  }
Â  Â  } catch (err) {
Â  Â  Â  message.textContent = 'âŒ An unexpected error occurred. Please try again.';
Â  Â  Â  message.classList.add('error');
Â  Â  }

Â  Â  registerBtn.disabled = false;
Â  Â  registerBtn.innerHTML = 'ğŸ‰ Register Account';
Â  });
</script>
</body>
</html>
