<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NurseIQ Admin - Real Database</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Simple Container -->
    <div id="app">
        <!-- Login Section -->
        <div id="login-section">
            <div style="text-align: center; padding: 50px 20px;">
                <h1><i class="fas fa-stethoscope"></i> NurseIQ Admin</h1>
                <p style="color: #666; margin-bottom: 30px;">Complete question & student management</p>
                
                <div style="max-width: 400px; margin: 0 auto; background: #f8f9fa; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <h2 style="margin-bottom: 20px;">Admin Login</h2>
                    
                    <div id="login-error" style="background: #fee; color: #c00; padding: 10px; border-radius: 5px; margin-bottom: 15px; display: none;">
                        <i class="fas fa-exclamation-circle"></i> <span id="error-message"></span>
                    </div>
                    
                    <div id="login-success" style="background: #dfd; color: #070; padding: 10px; border-radius: 5px; margin-bottom: 15px; display: none;">
                        <i class="fas fa-check-circle"></i> <span id="success-message"></span>
                    </div>
                    
                    <form id="login-form">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Email</label>
                            <input type="email" id="login-email" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" 
                                   placeholder="admin@example.com" required>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Password</label>
                            <input type="password" id="login-password" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" 
                                   placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                        </div>
                        
                        <button type="submit" id="login-button" style="width: 100%; background: #4f46e5; color: white; border: none; padding: 12px; border-radius: 5px; font-size: 16px; cursor: pointer;">
                            <i class="fas fa-sign-in-alt"></i> Sign In
                        </button>
                    </form>
                    
                    <div style="margin-top: 20px; font-size: 14px; color: #666;">
                        <p><i class="fas fa-info-circle"></i> Use any email/password for admin access</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="admin-section" style="display: none;">
            <!-- Header -->
            <div style="background: #4f46e5; color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1 style="margin: 0; font-size: 24px;"><i class="fas fa-stethoscope"></i> NurseIQ Admin</h1>
                    <p style="margin: 5px 0 0 0; opacity: 0.8;">Real Database Management System</p>
                </div>
                
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div id="user-info" style="background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px;">
                        <i class="fas fa-user"></i> <span id="dashboard-username">Admin</span>
                    </div>
                    <button onclick="logout()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>

            <!-- Main Content -->
            <div style="display: flex; min-height: calc(100vh - 80px);">
                <!-- Sidebar -->
                <div style="width: 250px; background: #f8f9fa; padding: 20px;">
                    <h3 style="margin-top: 0; color: #4f46e5;"><i class="fas fa-tachometer-alt"></i> Dashboard</h3>
                    <div style="margin-bottom: 30px;">
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                            <div style="color: #4f46e5; font-size: 24px; margin-bottom: 5px;" id="total-questions">0</div>
                            <div style="color: #666; font-size: 14px;">Total Questions</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                            <div style="color: #10b981; font-size: 24px; margin-bottom: 5px;" id="total-students">0</div>
                            <div style="color: #666; font-size: 14px;">Total Students</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                            <div style="color: #8b5cf6; font-size: 24px; margin-bottom: 5px;" id="total-courses">0</div>
                            <div style="color: #666; font-size: 14px;">Total Courses</div>
                        </div>
                    </div>
                    
                    <h4 style="color: #666; margin-bottom: 10px;">Quick Actions</h4>
                    <button onclick="showPage('create-question')" style="width: 100%; text-align: left; background: white; border: 1px solid #e5e7eb; padding: 10px 15px; margin-bottom: 8px; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-plus-circle" style="color: #4f46e5;"></i> Create Question
                    </button>
                    <button onclick="showPage('manage-questions')" style="width: 100%; text-align: left; background: white; border: 1px solid #e5e7eb; padding: 10px 15px; margin-bottom: 8px; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-list-check" style="color: #f59e0b;"></i> Manage Questions
                    </button>
                    <button onclick="showPage('document-upload')" style="width: 100%; text-align: left; background: white; border: 1px solid #e5e7eb; padding: 10px 15px; margin-bottom: 8px; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-file-upload" style="color: #10b981;"></i> Upload Document
                    </button>
                    <button onclick="showPage('manage-students')" style="width: 100%; text-align: left; background: white; border: 1px solid #e5e7eb; padding: 10px 15px; margin-bottom: 8px; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-users" style="color: #3b82f6;"></i> Manage Students
                    </button>
                    <button onclick="showPage('manage-courses')" style="width: 100%; text-align: left; background: white; border: 1px solid #e5e7eb; padding: 10px 15px; margin-bottom: 8px; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-book-medical" style="color: #8b5cf6;"></i> Manage Courses
                    </button>
                </div>

                <!-- Main Panel -->
                <div style="flex: 1; padding: 20px;">
                    <!-- Page: Create Question -->
                    <div id="page-create-question" class="page">
                        <h2><i class="fas fa-plus-circle"></i> Create New Question</h2>
                        
                        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <form id="question-form">
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Select Course *</label>
                                    <select id="question-course" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" required>
                                        <option value="">Loading courses...</option>
                                    </select>
                                </div>
                                
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Question Text *</label>
                                    <textarea id="question-text" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; min-height: 100px;" 
                                              placeholder="Enter your nursing question..." required></textarea>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Topic/Category</label>
                                        <input type="text" id="question-topic" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" 
                                               placeholder="e.g., Anatomy, Pharmacology">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Difficulty</label>
                                        <select id="question-difficulty" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                                            <option value="easy">Easy</option>
                                            <option value="medium" selected>Medium</option>
                                            <option value="hard">Hard</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Correct Answer *</label>
                                    <input type="text" id="correct-answer" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;" 
                                           placeholder="Enter the correct answer..." required>
                                </div>
                                
                                <div style="margin-bottom: 15px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Options (for multiple choice)</label>
                                    <div style="display: grid; gap: 10px;">
                                        <input type="text" id="option-a" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;" placeholder="Option A">
                                        <input type="text" id="option-b" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;" placeholder="Option B">
                                        <input type="text" id="option-c" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;" placeholder="Option C">
                                        <input type="text" id="option-d" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;" placeholder="Option D">
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Explanation</label>
                                    <textarea id="question-explanation" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; min-height: 60px;" 
                                              placeholder="Explain why this answer is correct..."></textarea>
                                </div>
                                
                                <div style="display: flex; gap: 10px;">
                                    <button type="button" onclick="saveQuestion()" style="background: #4f46e5; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer;">
                                        <i class="fas fa-save"></i> Save Question
                                    </button>
                                    <button type="button" onclick="resetQuestionForm()" style="background: #6b7280; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer;">
                                        <i class="fas fa-redo"></i> Clear
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
<!-- Page: Document Upload (PDF/Word) -->
<div id="page-document-upload" class="page" style="display: none;">
    <h2><i class="fas fa-file-upload"></i> Bulk Add Questions (Copy-Paste)</h2>
    
    <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <div style="margin-bottom: 25px;">
            <h3 style="margin-top: 0; color: #4f46e5;">Copy-Paste Questions</h3>
            <p style="color: #666; margin-bottom: 15px;">Simply copy-paste questions from any document. Each question should be on a new line with answers.</p>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Select Course *</label>
                <select id="document-course" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                    <option value="">Select a course</option>
                </select>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Paste Questions Here *</label>
                <textarea id="questions-text" style="width: 100%; padding: 15px; border: 2px solid #e5e7eb; border-radius: 8px; min-height: 300px; font-family: monospace; line-height: 1.5;" 
                          placeholder="Paste your questions here. Use any format!

Examples:
1. What is normal BP?
Answer: 120/80 mmHg
Explanation: Normal adult reading.

Q2. Vitamin from sunlight?
Ans: Vitamin D
Explanation: Skin produces it.

3) Heart chambers?
- Right atrium
- Right ventricle  
- Left atrium
- Left ventricle
Answer: All of the above

Or simple format:
Question: What is CPR?
Answer: Cardiopulmonary resuscitation
"></textarea>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 10px; font-weight: bold;">Question Format</label>
                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="radio" name="format-type" value="auto" checked> Auto-detect
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="radio" name="format-type" value="numbered"> Numbered (1., 2., etc.)
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="radio" name="format-type" value="qprefix"> Q-prefix (Q1, Q2, etc.)
                    </label>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button onclick="processTextQuestions()" id="process-btn" style="background: #4f46e5; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer;">
                    <i class="fas fa-cogs"></i> Extract Questions
                </button>
                <button onclick="clearTextArea()" style="background: #6b7280; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer;">
                    <i class="fas fa-times"></i> Clear
                </button>
                <button onclick="showExample()" style="background: #f59e0b; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer;">
                    <i class="fas fa-question-circle"></i> Show Example
                </button>
            </div>
        </div>
        
        <!-- Extracted Questions Preview -->
        <div id="extraction-results" style="display: none;">
            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div>
                        <h3 style="margin: 0;">Extracted Questions</h3>
                        <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">
                            Found <span id="questions-count" style="font-weight: bold; color: #4f46e5;">0</span> questions
                            <span id="saved-count" style="margin-left: 15px; color: #10b981; font-weight: bold;">0 saved</span>
                        </p>
                    </div>
                    <div>
                        <button onclick="saveAllExtractedQuestions()" style="background: #10b981; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                            <i class="fas fa-save"></i> Save All Questions
                        </button>
                        <button onclick="clearExtractionResults()" style="background: #6b7280; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>
                </div>
                
                <!-- Questions List -->
                <div id="questions-list" style="max-height: 400px; overflow-y: auto; margin-bottom: 20px;">
                    <!-- Questions will be listed here -->
                </div>
                
                <!-- Quick Actions -->
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button onclick="saveAllExtractedQuestions()" style="background: #4f46e5; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-save"></i> Save All Now
                    </button>
                    <button onclick="editInBulk()" style="background: #f59e0b; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-edit"></i> Edit All
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
                    <!-- Page: Document Upload (PDF/Word) -->
                    <div id="page-document-upload" class="page" style="display: none;">
                        <h2><i class="fas fa-file-upload"></i> Upload Document & Extract Questions</h2>
                        
                        <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <div style="margin-bottom: 25px;">
                                <h3 style="margin-top: 0; color: #4f46e5;">Upload Document</h3>
                                <p style="color: #666; margin-bottom: 15px;">Upload PDF or Word documents to extract questions. Each page will be treated as a separate question.</p>
                                
                                <div style="border: 2px dashed #d1d5db; padding: 30px; text-align: center; border-radius: 10px; margin-bottom: 20px;">
                                    <i class="fas fa-file-pdf" style="font-size: 48px; color: #ef4444; margin-bottom: 15px;"></i>
                                    <i class="fas fa-file-word" style="font-size: 48px; color: #2563eb; margin-bottom: 15px; margin-left: 20px;"></i>
                                    <p style="color: #6b7280; margin-bottom: 15px;">Drag & drop PDF or Word files here, or click to browse</p>
                                    <input type="file" id="document-file" accept=".pdf,.doc,.docx,.txt" style="display: none;">
                                    <button onclick="document.getElementById('document-file').click()" style="background: #4f46e5; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                        <i class="fas fa-folder-open"></i> Browse Files
                                    </button>
                                    <p id="selected-file" style="margin-top: 10px; color: #6b7280;"></p>
                                </div>
                                
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Select Course for these questions</label>
                                    <select id="document-course" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                                        <option value="">Loading courses...</option>
                                    </select>
                                </div>
                                
                                <div style="margin-bottom: 20px;">
                                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">Document Type</label>
                                    <div style="display: flex; gap: 20px;">
                                        <label style="display: flex; align-items: center; gap: 8px;">
                                            <input type="radio" name="doc-type" value="single" checked> Single question per page
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 8px;">
                                            <input type="radio" name="doc-type" value="multiple"> Multiple questions per page
                                        </label>
                                    </div>
                                </div>
                                
                                <button onclick="processDocument()" id="process-btn" style="background: #10b981; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer;">
                                    <i class="fas fa-cogs"></i> Process Document
                                </button>
                            </div>
                            
                            <!-- Extracted Questions Preview -->
                            <div id="extraction-results" style="display: none;">
                                <h3>Extracted Questions Preview</h3>
                                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                        <div>
                                            <strong>Found <span id="questions-count">0</span> questions</strong>
                                            <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">Review and edit before saving</p>
                                        </div>
                                        <div>
                                            <button onclick="saveAllExtractedQuestions()" style="background: #4f46e5; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                                                <i class="fas fa-save"></i> Save All Questions
                                            </button>
                                            <button onclick="clearExtractionResults()" style="background: #6b7280; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">
                                                <i class="fas fa-times"></i> Clear
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Questions Navigation -->
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                        <div style="color: #666;">
                                            Question <span id="current-question-num">1</span> of <span id="total-questions-num">0</span>
                                        </div>
                                        <div style="display: flex; gap: 10px;">
                                            <button onclick="prevQuestion()" id="prev-btn" style="background: #e5e7eb; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">
                                                <i class="fas fa-chevron-left"></i> Previous
                                            </button>
                                            <button onclick="nextQuestion()" id="next-btn" style="background: #e5e7eb; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">
                                                Next <i class="fas fa-chevron-right"></i>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Current Question Editor -->
                                    <div id="question-editor" style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #e5e7eb;">
                                        <div style="margin-bottom: 15px;">
                                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Question Text</label>
                                            <textarea id="extracted-question" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; min-height: 80px;"></textarea>
                                        </div>
                                        
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                                            <div>
                                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Correct Answer</label>
                                                <input type="text" id="extracted-answer" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                                            </div>
                                            <div>
                                                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Difficulty</label>
                                                <select id="extracted-difficulty" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                                                    <option value="medium">Medium</option>
                                                    <option value="easy">Easy</option>
                                                    <option value="hard">Hard</option>
                                                </select>
                                            </div>
                                        </div>
                                        
                                        <div style="margin-bottom: 10px;">
                                            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Explanation (Optional)</label>
                                            <textarea id="extracted-explanation" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; min-height: 60px;"></textarea>
                                        </div>
                                        
                                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                                            <button onclick="saveCurrentQuestion()" style="background: #10b981; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">
                                                <i class="fas fa-check"></i> Save This Question
                                            </button>
                                            <button onclick="skipCurrentQuestion()" style="background: #6b7280; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">
                                                <i class="fas fa-forward"></i> Skip
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Page: Manage Questions -->
                    <div id="page-manage-questions" class="page" style="display: none;">
                        <h2><i class="fas fa-list-check"></i> Manage Questions</h2>
                        <div id="questions-management-content">
                            <!-- Content loaded dynamically -->
                        </div>
                    </div>

                    <!-- Page: Manage Students -->
                    <div id="page-manage-students" class="page" style="display: none;">
                        <h2><i class="fas fa-users"></i> Manage Students</h2>
                        <div id="students-management-content">
                            <!-- Content loaded dynamically -->
                        </div>
                    </div>

                    <!-- Page: Manage Courses -->
                    <div id="page-manage-courses" class="page" style="display: none;">
                        <h2><i class="fas fa-book-medical"></i> Manage Courses</h2>
                        <div id="courses-management-content">
                            <!-- Content loaded dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="question-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: white; padding: 30px; border-radius: 10px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0;">Question Details</h3>
                <button onclick="closeModal()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
            </div>
            <div id="modal-content"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // ==================== CONFIGURATION ====================
        const SUPABASE_URL = 'https://lwhtjozfsmbyihenfunw.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx3aHRqb3pmc21ieWloZW5mdW53Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2NTgxMjcsImV4cCI6MjA3NTIzNDEyN30.7Z8AYvPQwTAEEEhODlW6Xk-IR1FK3Uj5ivZS7P17Wpk';
        
        // ==================== GLOBAL VARIABLES ====================
        let supabase = null;
        let currentUser = null;
        let extractedQuestions = [];
        let currentQuestionIndex = 0;
        
        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ Starting NurseIQ Admin (Real Database)...');
            
            try {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY, {
                    auth: { persistSession: false }
                });
                console.log('‚úÖ Supabase connected');
            } catch (error) {
                console.error('‚ùå Supabase error:', error);
                showError('Database Connection Error', 'Cannot connect to database');
                return;
            }
            
            checkLoginStatus();
        });
        
        function showError(title, message) {
            const errorDiv = document.getElementById('login-error');
            const errorMsg = document.getElementById('error-message');
            if (errorDiv && errorMsg) {
                errorMsg.textContent = message;
                errorDiv.style.display = 'block';
            } else {
                alert(`${title}: ${message}`);
            }
        }
        // ==================== DEBUG FUNCTION ====================
async function debugSupabase() {
    console.log('üîç Debugging Supabase connection...');
    
    try {
        // Test 1: Check if we can query the table
        console.log('Test 1: Querying table...');
        const { data: allUsers, error: allError } = await supabase
            .from('consolidated_user_profiles_table')
            .select('*')
            .limit(3);
        
        console.log('All users (first 3):', allUsers);
        console.log('All users error:', allError);
        
        // Test 2: Try to find the specific email
        console.log('Test 2: Searching for specific email...');
        const testEmail = 'tiongikevin99@gmail.com';
        const { data: specificUser, error: specificError } = await supabase
            .from('consolidated_user_profiles_table')
            .select('*')
            .eq('email', testEmail)
            .limit(1);
        
        console.log('Specific user query result:', specificUser);
        console.log('Specific user error:', specificError);
        console.log('User found?', specificUser && specificUser.length > 0 ? 'YES' : 'NO');
        
        if (specificUser && specificUser.length > 0) {
            console.log('User details:', specificUser[0]);
            console.log('User role:', specificUser[0].role);
        }
        
    } catch (err) {
        console.error('Debug error:', err);
    }
}

// Call this function after initializing Supabase
document.addEventListener('DOMContentLoaded', async function() {
    console.log('üöÄ Starting NurseIQ Admin (Real Database)...');
    
    try {
        supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY, {
            auth: { persistSession: false }
        });
        console.log('‚úÖ Supabase connected');
        
        // Run debug
        await debugSupabase();
        
    } catch (error) {
        console.error('‚ùå Supabase error:', error);
        showError('Database Connection Error', 'Cannot connect to database');
        return;
    }
    
    checkLoginStatus();
});
        // ==================== AUTHENTICATION ====================
        function checkLoginStatus() {
            const userData = localStorage.getItem('nurseiq_admin_session');
            
            if (userData) {
                try {
                    currentUser = JSON.parse(userData);
                    showAdminDashboard();
                    loadInitialData();
                } catch (e) {
                    console.log('Invalid session data');
                    localStorage.removeItem('nurseiq_admin_session');
                }
            }
        }
        
    document.getElementById('login-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const email = document.getElementById('login-email').value.trim();
    const password = document.getElementById('login-password').value;
    
    document.getElementById('login-error').style.display = 'none';
    const loginButton = document.getElementById('login-button');
    loginButton.disabled = true;
    loginButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Signing in...';
    
    try {
        // REAL DATABASE CHECK: Verify admin user
        // Use .limit(1) instead of .single() to avoid 406 error
        const { data: profiles, error } = await supabase
            .from('consolidated_user_profiles_table')
            .select('*')
            .eq('email', email)
            .limit(1);  // CHANGED: Use limit instead of single
        
        if (error) {
            console.error('Supabase error:', error);
            throw new Error('Database connection error');
        }
        
        if (!profiles || profiles.length === 0) {
            throw new Error('User not found in database');
        }
        
        const profile = profiles[0];  // Get first result
        
        // Check if user has admin role
        if (profile.role !== 'superadmin' && profile.role !== 'admin') {
            throw new Error('Admin access required. Current role: ' + profile.role);
        }
        
        // Store session
        const userData = {
            id: profile.id,
            email: profile.email,
            full_name: profile.full_name,
            role: profile.role,
            program: profile.program,
            timestamp: new Date().toISOString()
        };
        
        localStorage.setItem('nurseiq_admin_session', JSON.stringify(userData));
        currentUser = userData;
        
        document.getElementById('success-message').textContent = 'Login successful!';
        document.getElementById('login-success').style.display = 'block';
        
        setTimeout(() => {
            showAdminDashboard();
            loadInitialData();
        }, 1000);
        
    } catch (error) {
        console.error('Login error:', error);
        showError('Login Failed', error.message || 'Invalid credentials');
        loginButton.disabled = false;
        loginButton.innerHTML = '<i class="fas fa-sign-in-alt"></i> Sign In';
    }
});
        
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('nurseiq_admin_session');
                currentUser = null;
                showLoginPage();
            }
        }
        
        function showLoginPage() {
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('admin-section').style.display = 'none';
        }
        
        function showAdminDashboard() {
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('admin-section').style.display = 'block';
            
            if (currentUser) {
                const usernameElement = document.getElementById('dashboard-username');
                if (usernameElement) {
                    usernameElement.textContent = currentUser.full_name || currentUser.email || 'Admin';
                }
            }
            
            showPage('create-question');
        }
        
        // ==================== INITIAL DATA LOADING ====================
        async function loadInitialData() {
            try {
                // Load courses for dropdowns
                await loadCourses();
                
                // Load dashboard stats
                await loadDashboardStats();
                
            } catch (error) {
                console.error('Error loading initial data:', error);
            }
        }
        
        async function loadCourses() {
            try {
                const { data: courses, error } = await supabase
                    .from('courses')
                    .select('*')
                    .order('course_name');
                
                if (error) throw error;
                
                // Populate course dropdowns
                populateCourseDropdown('question-course', courses);
                populateCourseDropdown('document-course', courses);
                
                console.log(`‚úÖ Loaded ${courses?.length || 0} courses`);
                
            } catch (error) {
                console.error('Error loading courses:', error);
                showError('Courses Error', 'Failed to load courses');
            }
        }
        
        function populateCourseDropdown(dropdownId, courses) {
            const dropdown = document.getElementById(dropdownId);
            if (!dropdown) return;
            
            if (!courses || courses.length === 0) {
                dropdown.innerHTML = '<option value="">No courses available</option>';
                return;
            }
            
            const options = courses.map(course => 
                `<option value="${course.id}">${course.course_name} (${course.unit_code || 'No code'})</option>`
            ).join('');
            
            dropdown.innerHTML = '<option value="">Select a course</option>' + options;
        }
        
        async function loadDashboardStats() {
            try {
                // Count questions
                const { count: questionsCount } = await supabase
                    .from('medical_assessments')
                    .select('*', { count: 'exact', head: true });
                
                document.getElementById('total-questions').textContent = questionsCount || 0;
                
                // Count students (from consolidated_user_profiles_table)
                const { count: studentsCount } = await supabase
                    .from('consolidated_user_profiles_table')
                    .select('*', { count: 'exact', head: true });
                
                document.getElementById('total-students').textContent = studentsCount || 0;
                
                // Count courses
                const { count: coursesCount } = await supabase
                    .from('courses')
                    .select('*', { count: 'exact', head: true });
                
                document.getElementById('total-courses').textContent = coursesCount || 0;
                
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
            }
        }
        
        // ==================== QUESTION MANAGEMENT ====================
        async function saveQuestion() {
            const courseId = document.getElementById('question-course').value;
            const questionText = document.getElementById('question-text').value.trim();
            const correctAnswer = document.getElementById('correct-answer').value.trim();
            const topic = document.getElementById('question-topic').value.trim();
            const difficulty = document.getElementById('question-difficulty').value;
            const explanation = document.getElementById('question-explanation').value.trim();
            const optionA = document.getElementById('option-a').value.trim();
            const optionB = document.getElementById('option-b').value.trim();
            const optionC = document.getElementById('option-c').value.trim();
            const optionD = document.getElementById('option-d').value.trim();
            
            if (!courseId) {
                alert('Please select a course');
                return;
            }
            
            if (!questionText || !correctAnswer) {
                alert('Please fill in question and correct answer');
                return;
            }
            
            try {
                const questionData = {
                    question_text: questionText,
                    correct_answer: correctAnswer,
                    course_id: courseId,
                    topic: topic || null,
                    difficulty: difficulty,
                    explanation: explanation || null,
                    option_a: optionA || 'Option A',
                    option_b: optionB || 'Option B',
                    option_c: optionC || 'Option C',
                    option_d: optionD || 'Option D',
                    curriculum: 'KRCHN',
                    is_published: true,
                    is_active: true,
                    created_at: new Date().toISOString(),
                    question_type: optionA ? 'multiple_choice' : 'short_answer',
                    marks: 1,
                    estimated_time: 2
                };
                
                const { error } = await supabase
                    .from('medical_assessments')
                    .insert([questionData]);
                
                if (error) throw error;
                
                alert('‚úÖ Question saved successfully!');
                resetQuestionForm();
                loadDashboardStats();
                
            } catch (error) {
                console.error('Error saving question:', error);
                alert('Error saving question: ' + error.message);
            }
        }
        
        function resetQuestionForm() {
            document.getElementById('question-form').reset();
        }
        // ==================== SIMPLE COPY-PASTE QUESTION EXTRACTION ====================

let savedQuestionsCount = 0;

function clearTextArea() {
    document.getElementById('questions-text').value = '';
}

function showExample() {
    const exampleText = `1. What is the normal range for adult blood pressure?
Answer: 120/80 mmHg
Explanation: Normal adult blood pressure is typically around 120/80 mmHg.

2. Which vitamin is produced by the skin when exposed to sunlight?
Answer: Vitamin D
Explanation: Vitamin D is synthesized in the skin upon exposure to UVB radiation.

3. What is the primary function of red blood cells?
Answer: Transport oxygen
Explanation: Red blood cells contain hemoglobin which carries oxygen.

Q4. Name the chambers of the human heart.
Ans: Right atrium, right ventricle, left atrium, left ventricle
Explain: The heart has four chambers that work together.

5) What does "ABC" stand for in basic life support?
- Airway
- Breathing  
- Circulation
Correct answer: All of the above`;

    document.getElementById('questions-text').value = exampleText;
}

function processTextQuestions() {
    const text = document.getElementById('questions-text').value.trim();
    const courseId = document.getElementById('document-course').value;
    
    if (!text) {
        alert('Please paste some questions first');
        return;
    }
    
    if (!courseId) {
        alert('Please select a course for these questions');
        return;
    }
    
    const processBtn = document.getElementById('process-btn');
    processBtn.disabled = true;
    processBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
    
    try {
        // Simple extraction logic
        extractedQuestions = extractQuestionsSimple(text);
        
        if (extractedQuestions.length === 0) {
            // Try alternative method
            extractedQuestions = extractQuestionsFallback(text);
        }
        
        console.log(`Extracted ${extractedQuestions.length} questions`);
        
        if (extractedQuestions.length === 0) {
            throw new Error('No questions found. Please check your format.');
        }
        
        // Display results
        displayQuestionsList();
        
    } catch (error) {
        console.error('Error processing text:', error);
        alert('Error: ' + error.message);
    } finally {
        processBtn.disabled = false;
        processBtn.innerHTML = '<i class="fas fa-cogs"></i> Extract Questions';
    }
}

function extractQuestionsSimple(text) {
    const questions = [];
    const blocks = text.split(/\n\s*\n/); // Split by blank lines
    
    for (const block of blocks) {
        if (!block.trim()) continue;
        
        const lines = block.split('\n').map(l => l.trim()).filter(l => l);
        if (lines.length < 2) continue;
        
        // Find question (usually first line)
        let question = '';
        let answer = '';
        let explanation = '';
        
        // Try to identify question line
        for (let i = 0; i < lines.length; i++) {
            const line = lines[i];
            
            // Check if this looks like a question
            if (line.match(/^(\d+[\.\)]|Q\d+\.|Question|^\?|.*\?$)/i) || i === 0) {
                question = line.replace(/^(\d+[\.\)]|Q\d+\.|Question\s*\d*[:.]?\s*)/i, '').trim();
                
                // Look for answer in next lines
                for (let j = i + 1; j < lines.length; j++) {
                    if (lines[j].match(/^(Answer|Ans|Correct|A\.|-\s*)/i)) {
                        answer = lines[j].replace(/^(Answer|Ans|Correct|A\.)[:.]?\s*/i, '').trim();
                        
                        // Check for explanation
                        if (j + 1 < lines.length && lines[j + 1].match(/^(Explanation|Explain|Reason)/i)) {
                            explanation = lines[j + 1].replace(/^(Explanation|Explain|Reason)[:.]?\s*/i, '').trim();
                        }
                        break;
                    } else if (j === i + 1 && lines[j].length < 200) {
                        // If next line is short, assume it's the answer
                        answer = lines[j];
                    }
                }
                break;
            }
        }
        
        if (question && answer) {
            questions.push({
                id: questions.length + 1,
                question: question.endsWith('?') ? question : question + '?',
                answer: answer,
                explanation: explanation,
                saved: false
            });
        }
    }
    
    return questions;
}

function extractQuestionsFallback(text) {
    const questions = [];
    
    // Very simple fallback: split by lines ending with ?
    const lines = text.split('\n');
    let currentQuestion = '';
    let currentAnswer = '';
    
    for (const line of lines) {
        const trimmed = line.trim();
        
        if (trimmed.endsWith('?')) {
            // Save previous if exists
            if (currentQuestion && currentAnswer) {
                questions.push({
                    id: questions.length + 1,
                    question: currentQuestion,
                    answer: currentAnswer,
                    explanation: '',
                    saved: false
                });
            }
            
            currentQuestion = trimmed;
            currentAnswer = '';
        } else if (currentQuestion && !currentAnswer && trimmed && 
                   !trimmed.startsWith('Explanation:') && !trimmed.startsWith('Explain:')) {
            currentAnswer = trimmed;
        }
    }
    
    // Add last one
    if (currentQuestion && currentAnswer) {
        questions.push({
            id: questions.length + 1,
            question: currentQuestion,
            answer: currentAnswer,
            explanation: '',
            saved: false
        });
    }
    
    return questions;
}

function displayQuestionsList() {
    const questionsList = document.getElementById('questions-list');
    const questionsCount = document.getElementById('questions-count');
    
    questionsCount.textContent = extractedQuestions.length;
    savedQuestionsCount = extractedQuestions.filter(q => q.saved).length;
    document.getElementById('saved-count').textContent = savedQuestionsCount + ' saved';
    
    let html = '<div style="display: grid; gap: 10px;">';
    
    extractedQuestions.forEach((q, index) => {
        const statusColor = q.saved ? '#10b981' : '#6b7280';
        const statusIcon = q.saved ? 'fa-check-circle' : 'fa-clock';
        
        html += `
            <div style="background: white; padding: 15px; border-radius: 8px; border-left: 4px solid ${statusColor};">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                            <span style="background: #f3f4f6; color: #4f46e5; font-weight: bold; padding: 2px 8px; border-radius: 4px; font-size: 12px;">
                                ${index + 1}
                            </span>
                            <span style="color: ${statusColor}; font-size: 14px;">
                                <i class="fas ${statusIcon}"></i> ${q.saved ? 'Saved' : 'Pending'}
                            </span>
                        </div>
                        <div style="font-weight: 500; margin-bottom: 8px;">${q.question}</div>
                        <div style="background: #f0f9ff; padding: 8px; border-radius: 4px; margin-bottom: 8px;">
                            <strong style="color: #3b82f6;">Answer:</strong> ${q.answer}
                        </div>
                        ${q.explanation ? `<div style="color: #666; font-size: 14px; padding: 8px; background: #f9fafb; border-radius: 4px;">
                            <strong>Explanation:</strong> ${q.explanation}
                        </div>` : ''}
                    </div>
                    <div style="margin-left: 15px;">
                        <button onclick="saveSingleQuestion(${index})" style="background: ${q.saved ? '#6b7280' : '#4f46e5'}; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;" ${q.saved ? 'disabled' : ''}>
                            <i class="fas ${q.saved ? 'fa-check' : 'fa-save'}"></i> ${q.saved ? 'Saved' : 'Save'}
                        </button>
                    </div>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    questionsList.innerHTML = html;
    
    // Show results section
    document.getElementById('extraction-results').style.display = 'block';
    document.getElementById('extraction-results').scrollIntoView({ behavior: 'smooth' });
}

async function saveSingleQuestion(index) {
    const courseId = document.getElementById('document-course').value;
    const question = extractedQuestions[index];
    
    if (!question || question.saved) return;
    
    try {
        const questionData = {
            question_text: question.question,
            correct_answer: question.answer,
            course_id: courseId,
            difficulty: 'medium',
            explanation: question.explanation || null,
            curriculum: 'KRCHN',
            is_published: true,
            is_active: true,
            created_at: new Date().toISOString(),
            question_type: 'short_answer',
            marks: 1,
            estimated_time: 2
        };
        
        const { error } = await supabase
            .from('medical_assessments')
            .insert([questionData]);
        
        if (error) throw error;
        
        // Mark as saved
        extractedQuestions[index].saved = true;
        savedQuestionsCount++;
        
        // Update display
        document.getElementById('saved-count').textContent = savedQuestionsCount + ' saved';
        
        // Update the button
        const buttons = document.querySelectorAll(`button[onclick="saveSingleQuestion(${index})"]`);
        buttons.forEach(btn => {
            btn.innerHTML = '<i class="fas fa-check"></i> Saved';
            btn.style.background = '#6b7280';
            btn.disabled = true;
        });
        
        // Update dashboard stats
        loadDashboardStats();
        
    } catch (error) {
        console.error('Error saving question:', error);
        alert('Error saving question: ' + error.message);
    }
}

async function saveAllExtractedQuestions() {
    const courseId = document.getElementById('document-course').value;
    
    if (!courseId) {
        alert('Please select a course');
        return;
    }
    
    const unsavedQuestions = extractedQuestions.filter(q => !q.saved);
    
    if (unsavedQuestions.length === 0) {
        alert('All questions are already saved!');
        return;
    }
    
    if (!confirm(`Save ${unsavedQuestions.length} unsaved questions?`)) {
        return;
    }
    
    try {
        const questionsToSave = unsavedQuestions.map(q => ({
            question_text: q.question,
            correct_answer: q.answer,
            course_id: courseId,
            difficulty: 'medium',
            explanation: q.explanation || null,
            curriculum: 'KRCHN',
            is_published: true,
            is_active: true,
            created_at: new Date().toISOString(),
            question_type: 'short_answer',
            marks: 1,
            estimated_time: 2
        }));
        
        const { error } = await supabase
            .from('medical_assessments')
            .insert(questionsToSave);
        
        if (error) throw error;
        
        // Mark all as saved
        extractedQuestions.forEach(q => q.saved = true);
        savedQuestionsCount = extractedQuestions.length;
        
        // Update display
        displayQuestionsList();
        
        alert(`‚úÖ Successfully saved ${questionsToSave.length} questions!`);
        
        // Update dashboard stats
        loadDashboardStats();
        
    } catch (error) {
        console.error('Error saving questions:', error);
        alert('Error saving questions: ' + error.message);
    }
}

function clearExtractionResults() {
    if (extractedQuestions.filter(q => !q.saved).length > 0) {
        if (!confirm('You have unsaved questions. Clear anyway?')) {
            return;
        }
    }
    
    extractedQuestions = [];
    savedQuestionsCount = 0;
    document.getElementById('extraction-results').style.display = 'none';
    document.getElementById('questions-text').value = '';
}

function editInBulk() {
    // Simple bulk edit - just reload the text with current questions
    let text = '';
    extractedQuestions.forEach((q, i) => {
        text += `${i + 1}. ${q.question}\n`;
        text += `Answer: ${q.answer}\n`;
        if (q.explanation) {
            text += `Explanation: ${q.explanation}\n`;
        }
        text += '\n';
    });
    
    document.getElementById('questions-text').value = text;
    document.getElementById('extraction-results').style.display = 'none';
    alert('Questions loaded back into editor. Edit and re-extract.');
}
        // ==================== DOCUMENT UPLOAD & PROCESSING ====================
        document.getElementById('document-file').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const fileName = document.getElementById('selected-file');
            
            if (file) {
                fileName.textContent = `Selected: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`;
                fileName.style.color = '#10b981';
            } else {
                fileName.textContent = '';
            }
        });
        
        async function processDocument() {
            const fileInput = document.getElementById('document-file');
            const file = fileInput.files[0];
            const courseId = document.getElementById('document-course').value;
            
            if (!file) {
                alert('Please select a document file');
                return;
            }
            
            if (!courseId) {
                alert('Please select a course for these questions');
                return;
            }
            
            const processBtn = document.getElementById('process-btn');
            processBtn.disabled = true;
            processBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            
            try {
                // For now, we'll simulate document processing
                // In real implementation, you would:
                // 1. Upload file to server
                // 2. Use OCR/text extraction
                // 3. Parse questions
                
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Simulate extracted questions
                extractedQuestions = [
                    {
                        id: 1,
                        question: "What is the normal range for adult blood pressure?",
                        answer: "120/80 mmHg",
                        explanation: "Normal adult blood pressure is typically around 120/80 mmHg."
                    },
                    {
                        id: 2,
                        question: "Which vitamin is produced by the skin when exposed to sunlight?",
                        answer: "Vitamin D",
                        explanation: "Vitamin D is synthesized in the skin upon exposure to UVB radiation."
                    },
                    {
                        id: 3,
                        question: "What is the primary function of red blood cells?",
                        answer: "Transport oxygen",
                        explanation: "Red blood cells contain hemoglobin which carries oxygen throughout the body."
                    }
                ];
                
                // Display results
                displayExtractedQuestions();
                
            } catch (error) {
                console.error('Error processing document:', error);
                alert('Error processing document: ' + error.message);
            } finally {
                processBtn.disabled = false;
                processBtn.innerHTML = '<i class="fas fa-cogs"></i> Process Document';
            }
        }
        
        function displayExtractedQuestions() {
            if (extractedQuestions.length === 0) {
                alert('No questions found in document');
                return;
            }
            
            document.getElementById('questions-count').textContent = extractedQuestions.length;
            document.getElementById('total-questions-num').textContent = extractedQuestions.length;
            document.getElementById('extraction-results').style.display = 'block';
            
            // Scroll to results
            document.getElementById('extraction-results').scrollIntoView({ behavior: 'smooth' });
            
            // Show first question
            currentQuestionIndex = 0;
            showCurrentQuestion();
        }
        
        function showCurrentQuestion() {
            if (currentQuestionIndex < 0 || currentQuestionIndex >= extractedQuestions.length) return;
            
            const question = extractedQuestions[currentQuestionIndex];
            document.getElementById('current-question-num').textContent = currentQuestionIndex + 1;
            document.getElementById('extracted-question').value = question.question || '';
            document.getElementById('extracted-answer').value = question.answer || '';
            document.getElementById('extracted-explanation').value = question.explanation || '';
            
            // Update button states
            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
            document.getElementById('next-btn').disabled = currentQuestionIndex === extractedQuestions.length - 1;
        }
        
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showCurrentQuestion();
            }
        }
        
        function nextQuestion() {
            if (currentQuestionIndex < extractedQuestions.length - 1) {
                currentQuestionIndex++;
                showCurrentQuestion();
            }
        }
        
        async function saveCurrentQuestion() {
            const courseId = document.getElementById('document-course').value;
            const questionText = document.getElementById('extracted-question').value.trim();
            const answer = document.getElementById('extracted-answer').value.trim();
            const difficulty = document.getElementById('extracted-difficulty').value;
            const explanation = document.getElementById('extracted-explanation').value.trim();
            
            if (!questionText || !answer) {
                alert('Please fill in question and answer');
                return;
            }
            
            try {
                const questionData = {
                    question_text: questionText,
                    correct_answer: answer,
                    course_id: courseId,
                    difficulty: difficulty,
                    explanation: explanation || null,
                    curriculum: 'KRCHN',
                    is_published: true,
                    is_active: true,
                    created_at: new Date().toISOString(),
                    question_type: 'short_answer',
                    marks: 1,
                    estimated_time: 2
                };
                
                const { error } = await supabase
                    .from('medical_assessments')
                    .insert([questionData]);
                
                if (error) throw error;
                
                // Remove saved question from array
                extractedQuestions.splice(currentQuestionIndex, 1);
                
                if (extractedQuestions.length === 0) {
                    alert('‚úÖ All questions saved successfully!');
                    clearExtractionResults();
                } else {
                    // Adjust index if needed
                    if (currentQuestionIndex >= extractedQuestions.length) {
                        currentQuestionIndex = extractedQuestions.length - 1;
                    }
                    
                    showCurrentQuestion();
                    document.getElementById('questions-count').textContent = extractedQuestions.length;
                    document.getElementById('total-questions-num').textContent = extractedQuestions.length;
                    
                    alert('‚úÖ Question saved! ' + extractedQuestions.length + ' remaining');
                }
                
                loadDashboardStats();
                
            } catch (error) {
                console.error('Error saving question:', error);
                alert('Error saving question: ' + error.message);
            }
        }
        
        function skipCurrentQuestion() {
            if (currentQuestionIndex < extractedQuestions.length - 1) {
                currentQuestionIndex++;
                showCurrentQuestion();
            } else {
                alert('No more questions to skip');
            }
        }
        
        async function saveAllExtractedQuestions() {
            const courseId = document.getElementById('document-course').value;
            
            if (!courseId) {
                alert('Please select a course');
                return;
            }
            
            if (extractedQuestions.length === 0) {
                alert('No questions to save');
                return;
            }
            
            if (!confirm(`Save all ${extractedQuestions.length} questions?`)) {
                return;
            }
            
            try {
                const questionsToSave = extractedQuestions.map(q => ({
                    question_text: q.question || '',
                    correct_answer: q.answer || '',
                    course_id: courseId,
                    difficulty: 'medium',
                    explanation: q.explanation || null,
                    curriculum: 'KRCHN',
                    is_published: true,
                    is_active: true,
                    created_at: new Date().toISOString(),
                    question_type: 'short_answer',
                    marks: 1,
                    estimated_time: 2
                }));
                
                const { error } = await supabase
                    .from('medical_assessments')
                    .insert(questionsToSave);
                
                if (error) throw error;
                
                alert(`‚úÖ Successfully saved ${questionsToSave.length} questions!`);
                clearExtractionResults();
                loadDashboardStats();
                
            } catch (error) {
                console.error('Error saving questions:', error);
                alert('Error saving questions: ' + error.message);
            }
        }
        
        function clearExtractionResults() {
            extractedQuestions = [];
            currentQuestionIndex = 0;
            document.getElementById('extraction-results').style.display = 'none';
            document.getElementById('document-file').value = '';
            document.getElementById('selected-file').textContent = '';
        }
        
        // ==================== PAGE MANAGEMENT ====================
        function showPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                if (page.style) {
                    page.style.display = 'none';
                }
            });
            
            // Show selected page
            const pageElement = document.getElementById('page-' + pageName);
            if (pageElement) {
                pageElement.style.display = 'block';
                
                // Load specific page data
                switch(pageName) {
                    case 'manage-questions':
                        loadManageQuestionsPage();
                        break;
                    case 'manage-students':
                        loadManageStudentsPage();
                        break;
                    case 'manage-courses':
                        loadManageCoursesPage();
                        break;
                    case 'create-question':
                        loadCourses(); // Ensure courses are loaded
                        break;
                    case 'document-upload':
                        loadCourses(); // Ensure courses are loaded
                        break;
                }
            }
        }
        
        async function loadManageQuestionsPage() {
            const contentDiv = document.getElementById('questions-management-content');
            contentDiv.innerHTML = '<div style="text-align: center; padding: 40px;"><i class="fas fa-spinner fa-spin"></i> Loading questions...</div>';
            
            try {
                // Fetch questions with course names
                const { data: questions, error } = await supabase
                    .from('medical_assessments')
                    .select(`
                        *,
                        courses (
                            course_name,
                            unit_code
                        )
                    `)
                    .order('created_at', { ascending: false })
                    .limit(100);
                
                if (error) throw error;
                
                if (!questions || questions.length === 0) {
                    contentDiv.innerHTML = `
                        <div style="background: white; padding: 40px; border-radius: 10px; text-align: center;">
                            <i class="fas fa-inbox" style="font-size: 48px; color: #e5e7eb;"></i>
                            <h3 style="color: #6b7280;">No questions found</h3>
                            <p style="color: #9ca3af;">Create your first question using the "Create Question" page</p>
                        </div>
                    `;
                    return;
                }
                
                // Render questions table
                const tableHtml = `
                    <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="margin: 0;">${questions.length} Questions</h3>
                            <button onclick="loadManageQuestionsPage()" style="background: #4f46e5; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                        
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead style="background: #f8f9fa;">
                                    <tr>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">Question</th>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">Course</th>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">Difficulty</th>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">Created</th>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${questions.map(q => {
                                        const difficultyColor = {
                                            'easy': '#10b981',
                                            'medium': '#f59e0b',
                                            'hard': '#ef4444'
                                        }[q.difficulty] || '#6b7280';
                                        
                                        const courseName = q.courses?.course_name || 'No course';
                                        const courseCode = q.courses?.unit_code || '';
                                        
                                        return `
                                            <tr style="border-bottom: 1px solid #e5e7eb;">
                                                <td style="padding: 12px;">
                                                    <div style="font-weight: 500; margin-bottom: 4px;">${q.question_text?.substring(0, 80) || 'No question'}${q.question_text?.length > 80 ? '...' : ''}</div>
                                                    <div style="font-size: 12px; color: #6b7280;">Answer: ${q.correct_answer || 'No answer'}</div>
                                                </td>
                                                <td style="padding: 12px;">
                                                    <span style="background: #f3f4f6; padding: 4px 10px; border-radius: 12px; font-size: 12px;">
                                                        ${courseName} ${courseCode ? `(${courseCode})` : ''}
                                                    </span>
                                                </td>
                                                <td style="padding: 12px;">
                                                    <span style="color: ${difficultyColor}; font-weight: bold;">
                                                        ${q.difficulty || 'medium'}
                                                    </span>
                                                </td>
                                                <td style="padding: 12px; font-size: 14px; color: #6b7280;">
                                                    ${q.created_at ? new Date(q.created_at).toLocaleDateString() : 'Unknown'}
                                                </td>
                                                <td style="padding: 12px;">
                                                    <div style="display: flex; gap: 5px;">
                                                        <button onclick="viewQuestion('${q.id}')" style="background: #3b82f6; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                                                            <i class="fas fa-eye"></i>
                                                        </button>
                                                        <button onclick="deleteQuestion('${q.id}')" style="background: #ef4444; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                contentDiv.innerHTML = tableHtml;
                
            } catch (error) {
                console.error('Error loading questions:', error);
                contentDiv.innerHTML = `
                    <div style="background: #fee; color: #c00; padding: 20px; border-radius: 10px;">
                        <i class="fas fa-exclamation-circle"></i> Error loading questions: ${error.message}
                    </div>
                `;
            }
        }
        
        async function loadManageStudentsPage() {
            const contentDiv = document.getElementById('students-management-content');
            contentDiv.innerHTML = '<div style="text-align: center; padding: 40px;"><i class="fas fa-spinner fa-spin"></i> Loading students...</div>';
            
            try {
                // REAL DATABASE: Fetch students from consolidated_user_profiles_table
                const { data: students, error } = await supabase
                    .from('consolidated_user_profiles_table')
                    .select('*')
                    .order('full_name')
                    .limit(100);
                
                if (error) throw error;
                
                if (!students || students.length === 0) {
                    contentDiv.innerHTML = `
                        <div style="background: white; padding: 40px; border-radius: 10px; text-align: center;">
                            <i class="fas fa-users" style="font-size: 48px; color: #e5e7eb;"></i>
                            <h3 style="color: #6b7280;">No students found</h3>
                            <p style="color: #9ca3af;">Students will appear here when they register</p>
                        </div>
                    `;
                    return;
                }
                
                // Get student progress data
                const studentIds = students.map(s => s.id);
                const { data: progressData } = await supabase
                    .from('user_assessment_progress')
                    .select('user_id, is_correct')
                    .in('user_id', studentIds);
                
                // Calculate stats for each student
                const studentsWithStats = students.map(student => {
                    const studentProgress = progressData?.filter(p => p.user_id === student.id) || [];
                    const completed = studentProgress.length;
                    const correct = studentProgress.filter(p => p.is_correct).length;
                    const accuracy = completed > 0 ? Math.round((correct / completed) * 100) : 0;
                    
                    return {
                        ...student,
                        completed,
                        accuracy,
                        last_active: student.updated_at || student.created_at
                    };
                });
                
                // Render students table
                const tableHtml = `
                    <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="margin: 0;">${studentsWithStats.length} Students</h3>
                            <button onclick="loadManageStudentsPage()" style="background: #4f46e5; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 25px;">
                            <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; border-left: 4px solid #3b82f6;">
                                <div style="color: #3b82f6; font-size: 24px; font-weight: bold;">${studentsWithStats.length}</div>
                                <div style="color: #666; font-size: 14px;">Total Students</div>
                            </div>
                            <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; border-left: 4px solid #10b981;">
                                <div style="color: #10b981; font-size: 24px; font-weight: bold;">${studentsWithStats.filter(s => s.role === 'student').length}</div>
                                <div style="color: #666; font-size: 14px;">Regular Students</div>
                            </div>
                            <div style="background: #faf5ff; padding: 15px; border-radius: 8px; border-left: 4px solid #8b5cf6;">
                                <div style="color: #8b5cf6; font-size: 24px; font-weight: bold;">
                                    ${studentsWithStats.length > 0 ? 
                                        Math.round(studentsWithStats.reduce((sum, s) => sum + s.accuracy, 0) / studentsWithStats.length) : 0}%
                                </div>
                                <div style="color: #666; font-size: 14px;">Average Accuracy</div>
                            </div>
                        </div>
                        
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead style="background: #f8f9fa;">
                                    <tr>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">Student</th>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">Program</th>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">Completed</th>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">Accuracy</th>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">Role</th>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${studentsWithStats.map(student => {
                                        const accuracyColor = student.accuracy >= 90 ? '#10b981' : 
                                                            student.accuracy >= 75 ? '#f59e0b' : '#ef4444';
                                        
                                        const roleColor = student.role === 'admin' ? '#ef4444' : 
                                                         student.role === 'superadmin' ? '#8b5cf6' : '#3b82f6';
                                        
                                        return `
                                            <tr style="border-bottom: 1px solid #e5e7eb;">
                                                <td style="padding: 12px;">
                                                    <div style="display: flex; align-items: center; gap: 12px;">
                                                        <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, ${roleColor}, #7c3aed); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                                            ${student.full_name ? student.full_name.charAt(0).toUpperCase() : 'S'}
                                                        </div>
                                                        <div>
                                                            <div style="font-weight: 500;">${student.full_name || 'Unknown Student'}</div>
                                                            <div style="font-size: 12px; color: #6b7280;">${student.email || 'No email'}</div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td style="padding: 12px;">
                                                    <span style="background: #f3f4f6; padding: 4px 10px; border-radius: 12px; font-size: 12px;">
                                                        ${student.program || 'Unknown'}
                                                    </span>
                                                </td>
                                                <td style="padding: 12px; font-weight: 500;">
                                                    ${student.completed || 0}
                                                </td>
                                                <td style="padding: 12px;">
                                                    <span style="color: ${accuracyColor}; font-weight: bold;">
                                                        ${student.accuracy || 0}%
                                                    </span>
                                                </td>
                                                <td style="padding: 12px;">
                                                    <span style="background: ${roleColor === '#ef4444' ? '#fee2e2' : roleColor === '#8b5cf6' ? '#f5f3ff' : '#dbeafe'}; 
                                                           color: ${roleColor}; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 500;">
                                                        ${student.role || 'student'}
                                                    </span>
                                                </td>
                                                <td style="padding: 12px;">
                                                    <span style="background: #d1fae5; color: #065f46; padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 500;">
                                                        Active
                                                    </span>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                contentDiv.innerHTML = tableHtml;
                
            } catch (error) {
                console.error('Error loading students:', error);
                contentDiv.innerHTML = `
                    <div style="background: #fee; color: #c00; padding: 20px; border-radius: 10px;">
                        <i class="fas fa-exclamation-circle"></i> Error loading students: ${error.message}
                    </div>
                `;
            }
        }
        
        async function loadManageCoursesPage() {
            const contentDiv = document.getElementById('courses-management-content');
            contentDiv.innerHTML = '<div style="text-align: center; padding: 40px;"><i class="fas fa-spinner fa-spin"></i> Loading courses...</div>';
            
            try {
                const { data: courses, error } = await supabase
                    .from('courses')
                    .select('*')
                    .order('course_name');
                
                if (error) throw error;
                
                if (!courses || courses.length === 0) {
                    contentDiv.innerHTML = `
                        <div style="background: white; padding: 40px; border-radius: 10px; text-align: center;">
                            <i class="fas fa-book" style="font-size: 48px; color: #e5e7eb;"></i>
                            <h3 style="color: #6b7280;">No courses found</h3>
                            <p style="color: #9ca3af;">Add your first course using the "Create Question" page</p>
                        </div>
                    `;
                    return;
                }
                
                // Get question counts for each course
                const courseStats = await Promise.all(courses.map(async (course) => {
                    const { count } = await supabase
                        .from('medical_assessments')
                        .select('*', { count: 'exact', head: true })
                        .eq('course_id', course.id);
                    
                    return {
                        ...course,
                        question_count: count || 0
                    };
                }));
                
                // Render courses table
                const tableHtml = `
                    <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        <div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="margin: 0;">${courseStats.length} Courses</h3>
                            <div>
                                <button onclick="addNewCourse()" style="background: #10b981; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; margin-right: 10px;">
                                    <i class="fas fa-plus"></i> Add Course
                                </button>
                                <button onclick="loadManageCoursesPage()" style="background: #4f46e5; color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer;">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
                            ${courseStats.map(course => `
                                <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e5e7eb; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                        <div style="width: 12px; height: 12px; border-radius: 50%; background: ${course.color || '#4f46e5'};"></div>
                                        <h4 style="margin: 0; flex: 1;">${course.course_name}</h4>
                                    </div>
                                    <div style="color: #666; font-size: 14px; margin-bottom: 5px;">${course.unit_code || 'No code'}</div>
                                    <div style="color: #6b7280; font-size: 12px; margin-bottom: 10px;">${course.target_program || 'All programs'}</div>
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <span style="background: #f3f4f6; padding: 4px 10px; border-radius: 12px; font-size: 12px;">
                                            ${course.question_count} questions
                                        </span>
                                        <span style="background: ${course.status === 'Active' ? '#d1fae5' : '#fee2e2'}; 
                                               color: ${course.status === 'Active' ? '#065f46' : '#991b1b'}; 
                                               padding: 4px 10px; border-radius: 12px; font-size: 12px;">
                                            ${course.status || 'Unknown'}
                                        </span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead style="background: #f8f9fa;">
                                    <tr>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">Course Name</th>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">Unit Code</th>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">Program</th>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">Questions</th>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">Status</th>
                                        <th style="padding: 12px; text-align: left; border-bottom: 2px solid #e5e7eb;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${courseStats.map(course => `
                                        <tr style="border-bottom: 1px solid #e5e7eb;">
                                            <td style="padding: 12px;">
                                                <div style="display: flex; align-items: center; gap: 10px;">
                                                    <div style="width: 8px; height: 8px; border-radius: 50%; background: ${course.color || '#4f46e5'};"></div>
                                                    <div style="font-weight: 500;">${course.course_name}</div>
                                                </div>
                                                <div style="font-size: 12px; color: #6b7280; margin-top: 4px;">${course.description || 'No description'}</div>
                                            </td>
                                            <td style="padding: 12px;">
                                                <span style="background: #f3f4f6; padding: 4px 10px; border-radius: 12px; font-size: 12px;">
                                                    ${course.unit_code || 'N/A'}
                                                </span>
                                            </td>
                                            <td style="padding: 12px;">
                                                ${course.target_program || 'All'}
                                            </td>
                                            <td style="padding: 12px; font-weight: 500; color: #4f46e5;">
                                                ${course.question_count}
                                            </td>
                                            <td style="padding: 12px;">
                                                <span style="background: ${course.status === 'Active' ? '#d1fae5' : '#fee2e2'}; 
                                                       color: ${course.status === 'Active' ? '#065f46' : '#991b1b'}; 
                                                       padding: 4px 10px; border-radius: 12px; font-size: 12px; font-weight: 500;">
                                                    ${course.status || 'Unknown'}
                                                </span>
                                            </td>
                                            <td style="padding: 12px;">
                                                <div style="display: flex; gap: 5px;">
                                                    <button onclick="editCourse('${course.id}')" style="background: #f59e0b; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                                                        <i class="fas fa-edit"></i>
                                                    </button>
                                                    <button onclick="toggleCourseStatus('${course.id}')" style="background: ${course.status === 'Active' ? '#ef4444' : '#10b981'}; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                                                        <i class="fas fa-power-off"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
                
                contentDiv.innerHTML = tableHtml;
                
            } catch (error) {
                console.error('Error loading courses:', error);
                contentDiv.innerHTML = `
                    <div style="background: #fee; color: #c00; padding: 20px; border-radius: 10px;">
                        <i class="fas fa-exclamation-circle"></i> Error loading courses: ${error.message}
                    </div>
                `;
            }
        }
        
        // ==================== UTILITY FUNCTIONS ====================
        function closeModal() {
            document.getElementById('question-modal').style.display = 'none';
        }
        
        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            button:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }
            .fa-spin {
                animation: spin 1s linear infinite;
            }
            input[type="file"] {
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 5px;
                width: 100%;
            }
        `;
        document.head.appendChild(style);
        
        console.log('‚úÖ NurseIQ Admin (Real Database) ready!');
    </script>
</body>
</html>
