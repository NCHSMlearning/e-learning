<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NCHSM Lecturer Dashboard - Student Management</title>
    <style>
        /* Add these styles to your existing CSS */
        
        .filter-controls {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .filter-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #4C1D95;
        }
        
        .filter-group select, .filter-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        
        .student-status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-active { background: #D1FAE5; color: #065F46; }
        .status-inactive { background: #FEE2E2; color: #991B1B; }
        .status-at-risk { background: #FEF3C7; color: #92400E; }
        
        .risk-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        
        .risk-high { background: #EF4444; }
        .risk-medium { background: #F59E0B; }
        .risk-low { background: #10B981; }
        
        .action-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <!-- Add this enhanced student section to your dashboard -->
    <section id="my-students-content" class="tab-content">
        <h2><i class="fas fa-users"></i> Students Under My Supervision</h2>

        <!-- Enhanced Filter Controls -->
        <div class="filter-controls">
            <h4>Filter Students</h4>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="filter-intake">Intake Year</label>
                    <select id="filter-intake" onchange="filterStudents()">
                        <option value="all">All Intakes</option>
                        <option value="2024">2024 Intake</option>
                        <option value="2023">2023 Intake</option>
                        <option value="2022">2022 Intake</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filter-program">Program</label>
                    <select id="filter-program" onchange="filterStudents()">
                        <option value="all">All Programs</option>
                        <option value="KRCHN">KRCHN</option>
                        <option value="TVET">TVET</option>
                        <option value="BSCN">BSC Nursing</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filter-status">Academic Status</label>
                    <select id="filter-status" onchange="filterStudents()">
                        <option value="all">All Statuses</option>
                        <option value="active">Active</option>
                        <option value="at-risk">At Risk</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filter-block">Current Block</label>
                    <select id="filter-block" onchange="filterStudents()">
                        <option value="all">All Blocks</option>
                        <option value="A">Block A</option>
                        <option value="B">Block B</option>
                        <option value="C">Block C</option>
                    </select>
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="student-search">Search Students</label>
                    <input type="text" id="student-search" placeholder="Search by name, reg number, or email..." onkeyup="filterStudents()">
                </div>
                <div class="filter-group" style="display: flex; align-items: end;">
                    <button onclick="resetFilters()" style="padding: 8px 15px; background: #6B7280; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        Reset Filters
                    </button>
                </div>
            </div>
        </div>

        <!-- Student Statistics -->
        <div class="cards" style="margin-bottom: 20px;">
            <div class="card card-alert-success">
                <h3>Total Students</h3>
                <p class="data" id="total-students-count">0</p>
                <div class="card-description">Across all your courses</div>
            </div>
            <div class="card card-alert-primary">
                <h3>Current Intake</h3>
                <p class="data" id="current-intake-count">0</p>
                <div class="card-description" id="current-intake-label">2024 March Intake</div>
            </div>
            <div class="card card-alert-warning">
                <h3>Requiring Attention</h3>
                <p class="data" id="at-risk-count">0</p>
                <div class="card-description">Students at academic risk</div>
            </div>
        </div>

        <!-- Students Table -->
        <div class="table-container">
            <table class="students-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Reg. No.</th>
                        <th>Email</th>
                        <th>Program</th>
                        <th>Intake</th>
                        <th>Current Block</th>
                        <th>Status</th>
                        <th>Attendance %</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="students-table-body">
                    <tr><td colspan="9">Loading students...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="pagination" id="pagination-controls" style="margin-top: 20px; text-align: center; display: none;">
            <button id="prev-page" onclick="changePage(-1)">Previous</button>
            <span id="page-info">Page 1 of 1</span>
            <button id="next-page" onclick="changePage(1)">Next</button>
        </div>
    </section>

    <script>
        // Enhanced Student Management System
        let currentStudents = [];
        let filteredStudents = [];
        let currentPage = 1;
        const studentsPerPage = 10;

        // Mock data - In real implementation, this would come from your database
        const mockStudents = [
            {
                id: 1,
                name: "Mercy Chebet",
                regNo: "NCHS/KRCHN/001/2024",
                email: "mercy.chebet@student.nchsm.ac.ke",
                program: "KRCHN",
                intake: "2024",
                intakeMonth: "March",
                currentBlock: "A",
                status: "active",
                attendance: 92,
                riskLevel: "low",
                department: "Nursing",
                courses: ["HMIS 101", "ANAT 101"],
                phone: "+254712345678"
            },
            {
                id: 2,
                name: "John Kamau",
                regNo: "NCHS/KRCHN/002/2024",
                email: "john.kamau@student.nchsm.ac.ke",
                program: "KRCHN",
                intake: "2024",
                intakeMonth: "March",
                currentBlock: "A",
                status: "at-risk",
                attendance: 65,
                riskLevel: "high",
                department: "Nursing",
                courses: ["HMIS 101", "ANAT 101"],
                phone: "+254723456789"
            },
            {
                id: 3,
                name: "Sarah Achieng",
                regNo: "NCHS/TVET/001/2024",
                email: "sarah.achieng@student.nchsm.ac.ke",
                program: "TVET",
                intake: "2024",
                intakeMonth: "March",
                currentBlock: "A",
                status: "active",
                attendance: 88,
                riskLevel: "medium",
                department: "Nursing",
                courses: ["HMIS 101"],
                phone: "+254734567890"
            },
            {
                id: 4,
                name: "David Omondi",
                regNo: "NCHS/KRCHN/003/2023",
                email: "david.omondi@student.nchsm.ac.ke",
                program: "KRCHN",
                intake: "2023",
                intakeMonth: "September",
                currentBlock: "C",
                status: "active",
                attendance: 95,
                riskLevel: "low",
                department: "Nursing",
                courses: ["HMIS 201", "PHARM 201"],
                phone: "+254745678901"
            }
        ];

        // Lecturer profile - would come from your authentication system
        const lecturerProfile = {
            id: "NCHSM-LV-401",
            name: "Dr. Jane Doe",
            department: "Nursing",
            programs: ["KRCHN", "TVET"], // Lecturer is assigned to these programs
            currentIntakeFocus: "2024", // Focus on current year intake
            courses: ["HMIS 101", "HMIS 201"]
        };

        // Initialize student data
        function initializeStudentData() {
            // In real implementation, this would fetch from your API
            currentStudents = mockStudents;
            
            // Auto-filter based on lecturer's department and programs
            autoFilterByLecturerAssignment();
            
            // Update statistics
            updateStudentStatistics();
            
            // Display students
            filterStudents();
        }

        // Auto-filter students based on lecturer's assignment
        function autoFilterByLecturerAssignment() {
            // Set filters based on lecturer's assigned programs
            document.getElementById('filter-program').value = 'all'; // Show all programs lecturer is assigned to
            document.getElementById('filter-intake').value = lecturerProfile.currentIntakeFocus;
            
            // Update current intake label
            document.getElementById('current-intake-label').textContent = `${lecturerProfile.currentIntakeFocus} March Intake`;
        }

        // Filter students based on selected criteria
        function filterStudents() {
            const searchTerm = document.getElementById('student-search').value.toLowerCase();
            const intakeFilter = document.getElementById('filter-intake').value;
            const programFilter = document.getElementById('filter-program').value;
            const statusFilter = document.getElementById('filter-status').value;
            const blockFilter = document.getElementById('filter-block').value;

            filteredStudents = currentStudents.filter(student => {
                // Search term filter
                const matchesSearch = !searchTerm || 
                    student.name.toLowerCase().includes(searchTerm) ||
                    student.regNo.toLowerCase().includes(searchTerm) ||
                    student.email.toLowerCase().includes(searchTerm);

                // Intake filter
                const matchesIntake = intakeFilter === 'all' || student.intake === intakeFilter;

                // Program filter - only show programs lecturer is assigned to
                const matchesProgram = (programFilter === 'all' && lecturerProfile.programs.includes(student.program)) || 
                                      student.program === programFilter;

                // Status filter
                const matchesStatus = statusFilter === 'all' || student.status === statusFilter;

                // Block filter
                const matchesBlock = blockFilter === 'all' || student.currentBlock === blockFilter;

                return matchesSearch && matchesIntake && matchesProgram && matchesStatus && matchesBlock;
            });

            currentPage = 1;
            displayStudents();
            updateStudentStatistics();
            setupPagination();
        }

        // Display students in table
        function displayStudents() {
            const tbody = document.getElementById('students-table-body');
            const startIndex = (currentPage - 1) * studentsPerPage;
            const endIndex = startIndex + studentsPerPage;
            const studentsToShow = filteredStudents.slice(startIndex, endIndex);

            if (studentsToShow.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 20px;">No students found matching your criteria.</td></tr>';
                return;
            }

            tbody.innerHTML = studentsToShow.map(student => `
                <tr>
                    <td>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div class="risk-indicator risk-${student.riskLevel}"></div>
                            ${student.name}
                        </div>
                    </td>
                    <td>${student.regNo}</td>
                    <td>${student.email}</td>
                    <td>${student.program}</td>
                    <td>${student.intake} ${student.intakeMonth}</td>
                    <td>Block ${student.currentBlock}</td>
                    <td>
                        <span class="student-status-badge status-${student.status}">
                            ${student.status.charAt(0).toUpperCase() + student.status.slice(1)}
                        </span>
                    </td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="flex-grow: 1; height: 6px; background: #E5E7EB; border-radius: 3px; overflow: hidden;">
                                <div style="height: 100%; width: ${student.attendance}%; background: ${student.attendance >= 80 ? '#10B981' : student.attendance >= 70 ? '#F59E0B' : '#EF4444'};"></div>
                            </div>
                            <span>${student.attendance}%</span>
                        </div>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-action btn-view-profile" onclick="viewStudentProfile(${student.id})" title="View Profile">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-action" onclick="viewStudentAttendance(${student.id})" title="Attendance">
                                <i class="fas fa-clipboard-check"></i>
                            </button>
                            <button class="btn-action" onclick="messageStudent(${student.id})" title="Send Message">
                                <i class="fas fa-envelope"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Update student statistics
        function updateStudentStatistics() {
            const totalStudents = filteredStudents.length;
            const currentIntakeStudents = filteredStudents.filter(s => s.intake === lecturerProfile.currentIntakeFocus).length;
            const atRiskStudents = filteredStudents.filter(s => s.status === 'at-risk').length;

            document.getElementById('total-students-count').textContent = totalStudents;
            document.getElementById('current-intake-count').textContent = currentIntakeStudents;
            document.getElementById('at-risk-count').textContent = atRiskStudents;
        }

        // Pagination functions
        function setupPagination() {
            const totalPages = Math.ceil(filteredStudents.length / studentsPerPage);
            const pagination = document.getElementById('pagination-controls');
            const pageInfo = document.getElementById('page-info');
            const prevBtn = document.getElementById('prev-page');
            const nextBtn = document.getElementById('next-page');

            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }

            pagination.style.display = 'block';
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;
        }

        function changePage(direction) {
            const totalPages = Math.ceil(filteredStudents.length / studentsPerPage);
            currentPage += direction;
            
            if (currentPage < 1) currentPage = 1;
            if (currentPage > totalPages) currentPage = totalPages;
            
            displayStudents();
            setupPagination();
        }

        // Reset all filters
        function resetFilters() {
            document.getElementById('student-search').value = '';
            document.getElementById('filter-intake').value = 'all';
            document.getElementById('filter-program').value = 'all';
            document.getElementById('filter-status').value = 'all';
            document.getElementById('filter-block').value = 'all';
            
            filterStudents();
        }

        // Student action functions
        function viewStudentProfile(studentId) {
            const student = currentStudents.find(s => s.id === studentId);
            if (student) {
                alert(`Opening profile for: ${student.name}\nReg No: ${student.regNo}\nProgram: ${student.program}\nIntake: ${student.intake} ${student.intakeMonth}`);
                // In real implementation, open a modal or navigate to student profile page
            }
        }

        function viewStudentAttendance(studentId) {
            const student = currentStudents.find(s => s.id === studentId);
            if (student) {
                alert(`Viewing attendance for: ${student.name}\nCurrent Attendance: ${student.attendance}%`);
                // In real implementation, show attendance details
            }
        }

        function messageStudent(studentId) {
            const student = currentStudents.find(s => s.id === studentId);
            if (student) {
                alert(`Composing message to: ${student.name} (${student.email})`);
                // In real implementation, open message composer
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeStudentData();
        });
    </script>
</body>
</html>
